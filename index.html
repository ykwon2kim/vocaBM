<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë½€ë‘¥ì´ ë‹¨ì–´ì¥</title>
<link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Jua', sans-serif; background-color: #fff0f5; /* ë°°ê²½ì„ ì—°í•œ í•‘í¬ë¡œ ë³€ê²½ */ text-align: center; margin: 0; padding: 20px; color: #333; }
  
  .screen { display: none; max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
  .active { display: block; }

  /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  .btn { border: none; padding: 10px 20px; border-radius: 15px; cursor: pointer; font-family: 'Jua', sans-serif; font-size: 16px; margin: 5px; transition: 0.2s; }
  .btn:hover { transform: scale(1.05); }
  .btn-primary { background: #ff9a9e; color: white; width: 100%; font-size: 20px; padding: 15px; } /* ë©”ì¸ ë²„íŠ¼ í•‘í¬ìƒ‰ */
  .btn-danger { background: #ff6b6b; color: white; }
  .btn-secondary { background: #a8d8ea; color: white; }
  .btn-dark { background: #555; color: white; font-size: 14px; }
  .btn-purple { background: #aa96da; color: white; font-size: 14px; }
  .btn-edit { background: #fce38a; color: #555; font-size: 14px; }

  /* ëª©ë¡ ìŠ¤íƒ€ì¼ */
  .list-item { 
    background: #fff5f8; border: 2px solid #ffc3c3; 
    padding: 15px; margin-bottom: 10px; border-radius: 15px;
    display: flex; justify-content: space-between; align-items: center; text-align: left;
  }
  .list-info { cursor: pointer; flex-grow: 1; }
  .list-title { font-size: 20px; color: #ff6b6b; font-weight: bold; }
  .list-desc { font-size: 13px; color: #888; }
  .btn-group { display: flex; gap: 5px; }

  /* ì…ë ¥ì°½ */
  input[type="text"], textarea { width: 90%; padding: 12px; border: 2px solid #ffc3c3; border-radius: 10px; font-size: 16px; margin-top: 5px; font-family: sans-serif; }
  textarea { height: 100px; }
  
  /* ë°ì´í„° ì´ë™ ì˜ì—­ */
  .data-area { margin-top: 30px; border-top: 2px dashed #ddd; padding-top: 20px; }
  #dataInput { display: none; margin-bottom: 10px; border: 2px solid #aa96da; }

  /* ë©”ë‰´ ë²„íŠ¼ */
  .menu-bar { margin-bottom: 20px; }
  .menu-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
  .mode-btn { 
    flex: 1; 
    padding: 12px; border-radius: 15px; border: 2px solid #ddd; 
    cursor: pointer; font-family: 'Jua', sans-serif; font-size: 16px; 
    background: #fff; color: #555; 
  }
  .mode-btn.selected { background: #ff9a9e; color: white; font-weight: bold; border-color: #ff9a9e; box-shadow: 0 4px 10px rgba(255,154,158,0.4); }

  /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
  .status-bar { font-size: 18px; color: #666; margin-bottom: 10px; }
  
  .card-container { 
    perspective: 1000px; 
    width: 100%; 
    height: 380px; 
    margin: 10px auto; 
    cursor: pointer; 
  }
  .card { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; }
  .card.is-flipped { transform: rotateY(180deg); }
  
  .card-face { 
    position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
    display: flex; flex-direction: column; align-items: center; justify-content: center; 
    gap: 15px;
    border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
    border: 4px solid #ff9a9e; background: white; 
    padding: 20px; box-sizing: border-box; 
  }
  
  .card-text-main { font-size: 30px; color: #333; word-break: keep-all; line-height: 1.4; font-weight: bold; }
  .card-text-sub { 
    font-size: 20px; 
    color: #ff6b6b; 
    background-color: #fff0f5; 
    border-radius: 10px;
    padding: 10px;
    margin-top: 10px; 
    font-weight: bold; 
    display: block; 
    width: 90%; 
    box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
  }
  
  .card-back { transform: rotateY(180deg); background-color: #ff9a9e; color: white; }
  .card-back .card-text-main { color: white; font-size: 36px; }

  /* í€´ì¦ˆ ìŠ¤íƒ€ì¼ */
  .quiz-q { font-size: 22px; margin: 20px 0; font-weight: bold; word-break: keep-all; line-height: 1.5; }
  .quiz-input { width: 70%; padding: 10px; font-size: 20px; border: 3px solid #ff6b6b; border-radius: 10px; text-align: center; }
  .quiz-msg { height: 30px; margin: 10px 0; font-size: 18px; font-weight: bold; }
  
  /* ê²°ê³¼ì°½ */
  .result-box { display: none; background: #fff3e0; padding: 20px; border-radius: 15px; margin-top: 20px; border: 2px dashed #ff9800; }
  
  /* ìŠ¤í”¼ì»¤ ë²„íŠ¼ */
  .speak-btn { 
    background: #f9f9f9; border: 2px solid #ddd; border-radius: 50%; 
    width: 55px; height: 55px; 
    cursor: pointer; font-size: 28px; 
    transition: 0.2s; display: inline-flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .speak-btn:hover { transform: scale(1.1); background: #eee; }

  /* O, X ë²„íŠ¼ */
  .ox-btn { width: 70px; height: 70px; border-radius: 50%; font-size: 30px; border: none; cursor: pointer; margin: 0 10px; box-shadow: 0 4px 0 rgba(0,0,0,0.1); }
  .ox-btn:active { transform: translateY(4px); box-shadow: none; }
  .btn-o { background: #a8e6cf; color: #2e7d32; }
  .btn-x { background: #ff8b94; color: #c62828; }

</style>
</head>
<body>

  <!-- 1. ì„œì¬ í™”ë©´ -->
  <div id="screen-list" class="screen active">
    <h1>ğŸ¶ ë½€ë‘¥ì´ ë‹¨ì–´ì¥</h1>
    <div id="saved-list-container"></div>
    <div id="empty-msg" style="color:#aaa; margin:50px 0;">ì•„ì§ ë‹¨ì–´ì¥ì´ ì—†ì–´ìš”.<br>ë½€ë‘¥ì´ì™€ í•¨ê»˜ ê³µë¶€ë¥¼ ì‹œì‘í•´ë´ìš”!</div>
    <button class="btn btn-primary" onclick="showInputScreen()">+ ë‹¨ì–´ì¥ ìƒˆë¡œ ë§Œë“¤ê¸°</button>

    <div class="data-area">
        <p style="font-size:14px; color:#666;">ì»´í“¨í„° â†” í•¸ë“œí° ë°ì´í„° ì´ë™</p>
        <button class="btn btn-purple" onclick="exportData()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn btn-purple" onclick="toggleImport()">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</button>
        <div id="import-area" style="display:none; margin-top:10px;">
            <textarea id="dataInput" style="display:block; height:60px;" placeholder="ì½”ë“œë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"></textarea>
            <button class="btn btn-dark" onclick="importData()">í™•ì¸ (ë®ì–´ì“°ê¸°)</button>
        </div>
    </div>
  </div>

  <!-- 2. ì…ë ¥ í™”ë©´ -->
  <div id="screen-input" class="screen">
    <h2 id="input-title">âœ¨ ë‚´ìš© ì±„ìš°ê¸°</h2>
    <input type="text" id="listTitle" placeholder="ì œëª© (ì˜ˆ: Day 17)">
    
    <label style="display:block; text-align:left; margin-top:10px; font-weight:bold; color:#ff6b6b;">1. ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸</label>
    <textarea id="inputWords" placeholder="apple ì‚¬ê³¼&#10;busy ë°”ìœ"></textarea>

    <label style="display:block; text-align:left; margin-top:10px; font-weight:bold; color:#ff6b6b;">2. ì˜ˆë¬¸ ë¹ˆì¹¸ ë¬¸ì œ</label>
    <textarea id="inputSentences" placeholder="apple  (ë‚˜ëŠ” ì‚¬ê³¼ë¥¼ ë¨¹ì—ˆë‹¤) I ate an [ ____ ]."></textarea>
    
    <div style="margin-top:20px;">
      <button class="btn btn-secondary" onclick="showListScreen()">ì·¨ì†Œ</button>
      <button class="btn btn-primary" style="width:auto;" onclick="saveAndStart()">ì €ì¥í•˜ê³  ì‹œì‘ ğŸš€</button>
    </div>
  </div>

  <!-- 3. ê³µë¶€ í™”ë©´ -->
  <div id="screen-study" class="screen">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <button class="btn btn-secondary" style="font-size:14px;" onclick="showListScreen()">ğŸ  ì„œì¬ë¡œ</button>
      <span id="study-title" style="font-weight:bold; color:#ff6b6b;">Title</span>
    </div>

    <!-- ë©”ë‰´ ë²„íŠ¼ -->
    <div class="menu-bar">
        <div class="menu-row">
            <button class="mode-btn selected" id="m1" onclick="changeMode(1)">ë‹¨ì–´ ì¹´ë“œ</button>
            <button class="mode-btn" id="m2" onclick="changeMode(2)">ë‹¨ì–´ í€´ì¦ˆ</button>
        </div>
        <div class="menu-row">
            <button class="mode-btn" id="m3" onclick="changeMode(3)">ì˜ˆë¬¸ ì¹´ë“œ</button>
            <button class="mode-btn" id="m4" onclick="changeMode(4)">ì˜ˆë¬¸ í€´ì¦ˆ</button>
        </div>
    </div>

    <div id="study-container">
        <div class="status-bar" id="status-display">1 / 10</div>

        <!-- ì¹´ë“œ ì˜ì—­ -->
        <div id="card-area" style="display:block;">
            <div class="card-container" onclick="flipCard()">
                <div class="card" id="flashcard">
                    <div class="card-face card-front">
                        <div id="card-front-content" style="width:100%;"></div> 
                        <button class="speak-btn" id="btn-speak-front" onclick="playCurrentAudio(event)">ğŸ”Š</button>
                    </div>
                    <div class="card-face card-back">
                        <div id="card-back-content" style="width:100%;"></div> 
                        <button class="speak-btn" style="color:#333;" onclick="playCurrentAudio(event)">ğŸ”Š</button>
                    </div>
                </div>
            </div>
            <div style="margin-top:10px;" id="ox-buttons">
                <button class="ox-btn btn-x" onclick="mark(false)">âŒ</button>
                <button class="ox-btn btn-o" onclick="mark(true)">â­•</button>
            </div>
        </div>

        <!-- í€´ì¦ˆ ì˜ì—­ -->
        <div id="quiz-area" style="display:none;">
            <div id="quiz-question" class="quiz-q">ë¬¸ì œ</div>
            <input type="text" id="quiz-input" class="quiz-input" placeholder="ì •ë‹µ ì…ë ¥" autocomplete="off" onkeyup="if(window.event.keyCode==13){checkAnswer()}">
            <div id="quiz-msg" class="quiz-msg"></div>
            <button class="btn btn-primary" style="width:auto; margin-top:10px;" id="btn-check" onclick="checkAnswer()">í™•ì¸</button>
            <button class="btn btn-dark" style="display:none;" id="btn-next" onclick="nextItem()">ë‹¤ìŒ â–¶</button>
        </div>

        <!-- ê²°ê³¼ ë° ì¬ì‹œë„ -->
        <div id="result-box" class="result-box">
            <h3 id="result-msg">ê²°ê³¼</h3>
            <button class="btn btn-danger" id="btn-retry" onclick="retryWrong()">ğŸ”¥ í‹€ë¦° ê²ƒë§Œ ë‹¤ì‹œ í•˜ê¸°</button>
            <button class="btn btn-secondary" onclick="resetCurrentMode()">ğŸ”„ ì „ì²´ ë‹¤ì‹œ í•˜ê¸°</button>
        </div>
        
        <div style="margin-top:30px; border-top:1px dashed #ccc; padding-top:10px;">
             <button class="btn btn-dark" onclick="shuffleCurrent()">ğŸ”€ ìˆœì„œ ì„ê¸°</button>
        </div>
    </div>
  </div>

<script>
  let library = JSON.parse(localStorage.getItem('mySmartVocab') || '[]');
  let currentSet = {};
  let studyList = [];
  let wrongList = [];
  let currentIndex = 0;
  let currentMode = 1;
  let editingIndex = -1;

  function init() { renderLibrary(); }
  function renderLibrary() {
    const con = document.getElementById('saved-list-container');
    const empty = document.getElementById('empty-msg');
    con.innerHTML = "";
    if(library.length === 0) empty.style.display = 'block';
    else {
        empty.style.display = 'none';
        library.forEach((item, idx) => {
            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerHTML = `
                <div class="list-info" onclick="openStudy(${idx})">
                    <div class="list-title">${item.title}</div>
                    <div class="list-desc">ë‹¨ì–´ ${item.words.length}ê°œ / ì˜ˆë¬¸ ${item.sentences.length}ê°œ</div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-edit" style="padding:5px 10px;" onclick="editItem(${idx})">ìˆ˜ì •</button>
                    <button class="btn btn-danger" style="font-size:12px; padding:5px 10px;" onclick="delItem(${idx})">ì‚­ì œ</button>
                </div>
            `;
            con.appendChild(div);
        });
    }
  }
  function delItem(idx) { if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { library.splice(idx, 1); saveLib(); renderLibrary(); } }
  function saveLib() { localStorage.setItem('mySmartVocab', JSON.stringify(library)); }
  function exportData() {
    if(library.length === 0) { alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
    const dataStr = JSON.stringify(library);
    navigator.clipboard.writeText(dataStr).then(() => { alert("ë³µì‚¬ ì™„ë£Œ! ì¹´í†¡ìœ¼ë¡œ ë³´ë‚´ì„¸ìš”."); }).catch(() => prompt("ì½”ë“œ ë³µì‚¬:", dataStr));
  }
  function toggleImport() { const el = document.getElementById('import-area'); el.style.display = (el.style.display==='none'?'block':'none'); }
  function importData() {
    try {
        const data = JSON.parse(document.getElementById('dataInput').value.trim());
        if(confirm("ê¸°ì¡´ ë°ì´í„°ê°€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.")) { library = data; saveLib(); renderLibrary(); alert("ì™„ë£Œ!"); }
    } catch(e) { alert("ì½”ë“œê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤."); }
  }

  function showInputScreen() { 
    showScreen('screen-input'); 
    editingIndex = -1; 
    document.getElementById('input-title').innerText = "âœ¨ ìƒˆ ë‹¨ì–´ì¥ ë§Œë“¤ê¸°";
    document.getElementById('listTitle').value = ""; 
    document.getElementById('inputWords').value = ""; 
    document.getElementById('inputSentences').value = ""; 
  }

  function editItem(idx) {
    showScreen('screen-input');
    editingIndex = idx;
    document.getElementById('input-title').innerText = "âœï¸ ë‹¨ì–´ì¥ ìˆ˜ì •í•˜ê¸°";
    
    const item = library[idx];
    document.getElementById('listTitle').value = item.title;
    const wText = item.words.map(w => `${w.a}\t${w.q}`).join('\n');
    const sText = item.sentences.map(s => `${s.a}\t${s.q}`).join('\n');
    document.getElementById('inputWords').value = wText;
    document.getElementById('inputSentences').value = sText;
  }

  function saveAndStart() {
    const title = document.getElementById('listTitle').value.trim();
    const wText = document.getElementById('inputWords').value.trim();
    const sText = document.getElementById('inputSentences').value.trim();
    if(!title) return alert("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!");
    const words = parseText(wText);
    const sentences = parseText(sText);
    if(words.length === 0 && sentences.length === 0) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    
    const newItem = { title, words, sentences };
    if(editingIndex === -1) { library.push(newItem); saveLib(); openStudy(library.length - 1); } 
    else { library[editingIndex] = newItem; saveLib(); openStudy(editingIndex); }
  }

  function parseText(text) {
    if(!text) return [];
    return text.split('\n').map(line => {
        line = line.trim(); if(!line) return null;
        let parts = line.split(/[\t]+| {2,}/);
        if(parts.length < 2 && line.includes(' ')) { let idx = line.indexOf(' '); parts = [line.substring(0, idx), line.substring(idx+1)]; }
        if(parts.length >= 2) return { q: parts[1].trim(), a: parts[0].trim() };
        return null;
    }).filter(x => x);
  }

  function openStudy(idx) { currentSet = library[idx]; document.getElementById('study-title').innerText = currentSet.title; showScreen('screen-study'); changeMode(1); }
  
  function changeMode(mode) {
    currentMode = mode;
    [1,2,3,4].forEach(n => document.getElementById(`m${n}`).className = 'mode-btn' + (n===mode ? ' selected' : ''));
    if(mode === 1 || mode === 2) studyList = [...currentSet.words];
    else {
        studyList = [...currentSet.sentences];
        if(studyList.length === 0) { alert("ì˜ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤."); changeMode(1); return; }
    }
    resetCurrentMode();
  }

  function resetCurrentMode() {
    currentIndex = 0; wrongList = [];
    document.getElementById('result-box').style.display = 'none';
    const isCard = (currentMode === 1 || currentMode === 3); 
    document.getElementById('card-area').style.display = isCard ? 'block' : 'none';
    document.getElementById('quiz-area').style.display = isCard ? 'none' : 'block';
    showItem();
  }

  function shuffleCurrent() { studyList.sort(() => Math.random() - 0.5); resetCurrentMode(); }

  function showItem() {
    if(currentIndex >= studyList.length) { finishStudy(); return; }
    const item = studyList[currentIndex];
    document.getElementById('status-display').innerText = `${currentIndex + 1} / ${studyList.length}`;

    if(currentMode === 1) { // ë‹¨ì–´ ì¹´ë“œ
        renderCard(item.a, item.q, true); 
    } else if(currentMode === 3) { // ì˜ˆë¬¸ ì¹´ë“œ
        let match = item.q.match(/\(([^)]+)\)/); 
        let kor = ""; let eng = item.q;
        if(match) { kor = match[1]; eng = item.q.replace(match[0], "").trim(); }
        const frontHtml = `<div class="card-text-main">${eng}</div><div class="card-text-sub">${kor}</div>`;
        const backHtml = `<div class="card-text-main">${item.a}</div>`;
        renderCardHtml(frontHtml, backHtml, false);
    } else { // í€´ì¦ˆ ëª¨ë“œ
        let displayQ = item.q;
        if(currentMode === 4) {
             let match = item.q.match(/\(([^)]+)\)/); 
             if(match) {
                 let eng = item.q.replace(match[0], "").trim();
                 displayQ = `${eng}<br><span style="color:#ff6b6b; font-size:18px;">(${match[1]})</span>`;
             }
        }
        document.getElementById('quiz-question').innerHTML = displayQ;
        document.getElementById('quiz-input').value = "";
        document.getElementById('quiz-msg').innerText = "";
        document.getElementById('btn-check').style.display = 'inline-block';
        document.getElementById('btn-next').style.display = 'none';
        document.getElementById('quiz-input').focus();
    }
  }

  function renderCard(frontText, backText, showFrontSpeaker) {
     renderCardHtml(`<div class="card-text-main">${frontText}</div>`, `<div class="card-text-main">${backText}</div>`, showFrontSpeaker);
  }

  function renderCardHtml(frontHtml, backHtml, showFrontSpeaker) {
    const card = document.getElementById('flashcard');
    card.classList.remove('is-flipped');
    document.getElementById('btn-speak-front').style.display = showFrontSpeaker ? 'inline-flex' : 'none';
    setTimeout(() => {
        document.getElementById('card-front-content').innerHTML = frontHtml;
        document.getElementById('card-back-content').innerHTML = backHtml;
    }, 200);
  }

  function mark(isCorrect) {
    if(!isCorrect) wrongList.push(studyList[currentIndex]);
    currentIndex++;
    showItem();
  }

  function checkAnswer() {
    const user = document.getElementById('quiz-input').value.trim().toLowerCase();
    const ans = studyList[currentIndex].a.toLowerCase();
    const msg = document.getElementById('quiz-msg');
    if(user === ans) { 
        msg.innerHTML = "<span style='color:green'>ì •ë‹µ! â­•</span>"; 
        playAudio(ans);
    } else { 
        msg.innerHTML = `<span style='color:red'>ë•¡! ì •ë‹µ: ${ans}</span>`; 
        wrongList.push(studyList[currentIndex]); 
    }
    document.getElementById('btn-check').style.display = 'none'; 
    document.getElementById('btn-next').style.display = 'inline-block'; 
    document.getElementById('btn-next').focus();
  }
  function nextItem() { currentIndex++; showItem(); }

  function finishStudy() {
    document.getElementById('card-area').style.display = 'none';
    document.getElementById('quiz-area').style.display = 'none';
    document.getElementById('result-box').style.display = 'block';
    const msg = document.getElementById('result-msg');
    const retryBtn = document.getElementById('btn-retry');
    if(wrongList.length > 0) {
        msg.innerText = `${wrongList.length}ê°œë¥¼ í‹€ë ¸ì–´ìš”. ë‹¤ì‹œ ë„ì „!`;
        retryBtn.style.display = 'inline-block';
        retryBtn.innerText = `ğŸ”¥ í‹€ë¦° ${wrongList.length}ê°œ ë‹¤ì‹œ í•˜ê¸°`;
    } else {
        msg.innerText = "ğŸ‰ ì™„ë²½í•´ìš”! 100ì !";
        retryBtn.style.display = 'none';
    }
  }

  function retryWrong() { studyList = [...wrongList]; resetCurrentMode(); }
  function flipCard() { 
    const card = document.getElementById('flashcard');
    card.classList.toggle('is-flipped');
    if(card.classList.contains('is-flipped')) playAudio(studyList[currentIndex].a);
  }
  function playCurrentAudio(e) {
    if(e) e.stopPropagation();
    let textToPlay = studyList[currentIndex].a;
    if(currentMode === 1) textToPlay = studyList[currentIndex].a; 
    playAudio(textToPlay);
  }
  function playAudio(text) { 
    if(!text) return;
    const url = `https://translate.google.com/translate_tts?ie=UTF-8&tl=en&client=tw-ob&q=${encodeURIComponent(text)}`;
    new Audio(url).play(); 
  }
  
  function showScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
  function showListScreen() { showScreen('screen-list'); init(); }
  window.onload = init;
</script>
</body>
</html>
