<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë½€ë‘¥ì´ ë‹¨ì–´ì¥</title>
<link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Jua', sans-serif; background-color: #fff0f5; text-align: center; margin: 0; padding: 20px; color: #333; }
  .screen { display: none; max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
  .active { display: block; }
  .btn { border: none; padding: 10px 20px; border-radius: 15px; cursor: pointer; font-family: 'Jua', sans-serif; font-size: 16px; margin: 5px; transition: 0.2s; }
  .btn:hover { transform: scale(1.05); }
  .btn-primary { background: #ff9a9e; color: white; width: 100%; font-size: 20px; padding: 15px; }
  .btn-danger { background: #ff6b6b; color: white; }
  .btn-secondary { background: #a8d8ea; color: white; }
  .btn-dark { background: #555; color: white; font-size: 14px; }
  .btn-purple { background: #9b59b6; color: white; font-size: 14px; }
  .btn-edit { background: #fce38a; color: #555; font-size: 14px; }
  .list-item { background: #fff5f8; border: 2px solid #ffc3c3; padding: 15px; margin-bottom: 10px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; text-align: left; }
  .list-info { cursor: pointer; flex-grow: 1; }
  .list-title { font-size: 20px; color: #ff6b6b; font-weight: bold; }
  .list-desc { font-size: 13px; color: #888; }
  .btn-group { display: flex; gap: 5px; }
  input[type="text"], textarea { width: 90%; padding: 12px; border: 2px solid #ffc3c3; border-radius: 10px; font-size: 16px; margin-top: 5px; font-family: sans-serif; }
  textarea { height: 100px; }
  .data-area { margin-top: 30px; border-top: 2px dashed #ddd; padding-top: 20px; }
  #dataInput { display: none; margin-bottom: 10px; border: 2px solid #aa96da; }
  .menu-bar { margin-bottom: 20px; }
  .menu-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
  .mode-btn { flex: 1; padding: 12px; border-radius: 15px; border: 2px solid #ddd; cursor: pointer; font-family: 'Jua', sans-serif; font-size: 16px; background: #fff; color: #555; }
  .mode-btn.selected { background: #ff9a9e; color: white; font-weight: bold; border-color: #ff9a9e; box-shadow: 0 4px 10px rgba(255,154,158,0.4); }
  .status-bar { font-size: 18px; color: #666; margin-bottom: 10px; }
  .card-container { perspective: 1000px; width: 100%; height: 380px; margin: 10px auto; cursor: pointer; }
  .card { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; }
  .card.is-flipped { transform: rotateY(180deg); }
  .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 4px solid #ff9a9e; background: white; padding: 20px; box-sizing: border-box; }
  
  /* ì¹´ë“œ í…ìŠ¤íŠ¸ */
  .card-text-main { font-size: 30px; color: #333; word-break: keep-all; line-height: 1.5; font-weight: bold; }
  
  /* ì˜ˆë¬¸ í•´ì„ ë°•ìŠ¤ */
  .card-text-sub { font-size: 20px; color: #1565c0; background-color: #e3f2fd; border-radius: 10px; padding: 10px; margin-top: 10px; font-weight: bold; display: block; width: 90%; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
  
  /* ë’·ë©´ */
  .card-back { transform: rotateY(180deg); background-color: #ff9a9e; color: white; }
  .card-back .card-text-main { color: white; font-size: 32px; }
  /* ë’·ë©´ ì˜ˆë¬¸ í•´ì„ ë°•ìŠ¤ (í°ìƒ‰ ë°°ê²½) */
  .card-back .card-text-sub { background-color: rgba(255,255,255,0.2); color: #fff; border: 1px solid #fff; }

  /* í€´ì¦ˆ */
  .quiz-q { font-size: 22px; margin: 20px 0; font-weight: bold; word-break: keep-all; line-height: 1.5; }
  .quiz-input { width: 70%; padding: 10px; font-size: 20px; border: 3px solid #ff6b6b; border-radius: 10px; text-align: center; }
  .quiz-msg { height: 30px; margin: 10px 0; font-size: 18px; font-weight: bold; }
  .result-box { display: none; background: #fff3e0; padding: 20px; border-radius: 15px; margin-top: 20px; border: 2px dashed #ff9800; }
  
  /* ìŠ¤í”¼ì»¤ */
  .speak-btn { background: #f9f9f9; border: 2px solid #ddd; border-radius: 50%; width: 55px; height: 55px; cursor: pointer; font-size: 28px; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; z-index: 10; color: #333; }
  .speak-btn:hover { transform: scale(1.1); background: #eee; }
  .card-back .speak-btn { background: rgba(255,255,255,0.3); border-color: #fff; color: white; }

  .ox-btn { width: 70px; height: 70px; border-radius: 50%; font-size: 30px; border: none; cursor: pointer; margin: 0 10px; box-shadow: 0 4px 0 rgba(0,0,0,0.1); }
  .ox-btn:active { transform: translateY(4px); box-shadow: none; }
  .btn-o { background: #a8e6cf; color: #2e7d32; }
  .btn-x { background: #ff8b94; color: #c62828; }
</style>
</head>
<body>

  <!-- ì„œì¬ í™”ë©´ -->
  <div id="screen-list" class="screen active">
    <h1>ğŸ¶ ë½€ë‘¥ì´ ë‹¨ì–´ì¥</h1>
    <div id="saved-list-container"></div>
    <div style="margin-top:20px; color:#666; font-size:14px;">* ë°ì´í„° ìˆ˜ì • ì‹œ ìë™ ê°±ì‹  *</div>
    
    <div class="data-area">
        <p style="font-size:14px; color:#666;">ì»´í“¨í„° â†” í•¸ë“œí° ë°ì´í„° ì´ë™</p>
        <button class="btn btn-purple" onclick="exportData()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn btn-purple" onclick="toggleImport()">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</button>
        <div id="import-area" style="display:none; margin-top:10px;">
            <textarea id="dataInput" style="display:block; height:60px;" placeholder="ì½”ë“œë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"></textarea>
            <button class="btn btn-dark" onclick="importData()">í™•ì¸ (ë®ì–´ì“°ê¸°)</button>
        </div>
    </div>
  </div>

  <!-- ì…ë ¥ í™”ë©´ -->
  <div id="screen-input" class="screen">
    <h2 id="input-title">âœ¨ ë‚´ìš© ì±„ìš°ê¸°</h2>
    <input type="text" id="listTitle" placeholder="ì œëª©">
    <label style="display:block; text-align:left; margin-top:10px; font-weight:bold; color:#ff6b6b;">1. ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸</label>
    <textarea id="inputWords"></textarea>
    <label style="display:block; text-align:left; margin-top:10px; font-weight:bold; color:#ff6b6b;">2. ì˜ˆë¬¸ ë¹ˆì¹¸ ë¬¸ì œ</label>
    <textarea id="inputSentences"></textarea>
    <div style="margin-top:20px;">
      <button class="btn btn-secondary" onclick="showListScreen()">ì·¨ì†Œ</button>
      <button class="btn btn-primary" style="width:auto;" onclick="saveAndStart()">ì €ì¥í•˜ê³  ì‹œì‘ ğŸš€</button>
    </div>
  </div>

  <!-- ê³µë¶€ í™”ë©´ -->
  <div id="screen-study" class="screen">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <button class="btn btn-secondary" style="font-size:14px;" onclick="showListScreen()">ğŸ  ì„œì¬ë¡œ</button>
      <span id="study-title" style="font-weight:bold; color:#ff6b6b;">Title</span>
    </div>
    <div class="menu-bar">
        <div class="menu-row">
            <button class="mode-btn selected" id="m1" onclick="changeMode(1)">ë‹¨ì–´ ì¹´ë“œ</button>
            <button class="mode-btn" id="m2" onclick="changeMode(2)">ë‹¨ì–´ í€´ì¦ˆ</button>
        </div>
        <div class="menu-row">
            <button class="mode-btn" id="m3" onclick="changeMode(3)">ì˜ˆë¬¸ ì¹´ë“œ</button>
            <button class="mode-btn" id="m4" onclick="changeMode(4)">ì˜ˆë¬¸ í€´ì¦ˆ</button>
        </div>
    </div>
    <div id="study-container">
        <div class="status-bar" id="status-display">1 / 10</div>
        
        <div id="card-area" style="display:block;">
            <div class="card-container" onclick="flipCard()">
                <div class="card" id="flashcard">
                    <div class="card-face card-front">
                        <div id="card-front-content" style="width:100%;"></div> 
                        <!-- ì•ë©´ ìŠ¤í”¼ì»¤ ë²„íŠ¼ -->
                        <div id="btn-speak-front" class="speak-btn" onclick="playCurrentAudio(event)">ğŸ”Š</div>
                    </div>
                    <div class="card-face card-back">
                        <div id="card-back-content" style="width:100%;"></div> 
                        <!-- ë’·ë©´ ìŠ¤í”¼ì»¤ ë²„íŠ¼ -->
                        <div class="speak-btn" onclick="playCurrentAudio(event)">ğŸ”Š</div>
                    </div>
                </div>
            </div>
            <div style="margin-top:10px;" id="ox-buttons">
                <button class="ox-btn btn-x" onclick="mark(false)">âŒ</button>
                <button class="ox-btn btn-o" onclick="mark(true)">â­•</button>
            </div>
        </div>

        <div id="quiz-area" style="display:none;">
            <div id="quiz-question" class="quiz-q">ë¬¸ì œ</div>
            <input type="text" id="quiz-input" class="quiz-input" placeholder="ì •ë‹µ ì…ë ¥" autocomplete="off" onkeyup="if(window.event.keyCode==13){checkAnswer()}">
            <div id="quiz-msg" class="quiz-msg"></div>
            <button class="btn btn-primary" style="width:auto; margin-top:10px;" id="btn-check" onclick="checkAnswer()">í™•ì¸</button>
            <button class="btn btn-dark" style="display:none;" id="btn-next" onclick="nextItem()">ë‹¤ìŒ â–¶</button>
        </div>

        <div id="result-box" class="result-box">
            <h3 id="result-msg">ê²°ê³¼</h3>
            <button class="btn btn-danger" id="btn-retry" onclick="retryWrong()">ğŸ”¥ í‹€ë¦° ê²ƒë§Œ ë‹¤ì‹œ í•˜ê¸°</button>
            <button class="btn btn-secondary" onclick="resetCurrentMode()">ğŸ”„ ì „ì²´ ë‹¤ì‹œ í•˜ê¸°</button>
        </div>
        
        <div style="margin-top:30px; border-top:1px dashed #ccc; padding-top:10px;">
             <button class="btn btn-dark" onclick="shuffleCurrent()">ğŸ”€ ìˆœì„œ ì„ê¸°</button>
        </div>
    </div>
  </div>

<script>
  // ==========================================
  // ğŸ‘‡ 1. ë°ì´í„° ì €ì¥ì†Œ (ì •ë‹µ ëª¨ë‘ ì œê±°ë¨!)
  // ==========================================
  const defaultData = [
    {
      title: "Day 17 (0321~0340)",
      words: [
        {q:"ë°”ìœ, í˜¼ì¡í•œ", a:"busy"}, {q:"ì¼ì°, ë¹¨ë¦¬", a:"early"}, {q:"ìŒì‹, ì‹ëŸ‰", a:"food"}, {q:"ê±°ì˜", a:"almost"},
        {q:"ê°€ì ¸ì˜¤ë‹¤", a:"bring"}, {q:"ê·¸ë¦¬ë‹¤, ëŒë‹¤", a:"draw"}, {q:"ê°€ë¡œì§€ë¥´ë‹¤", a:"cross"}, {q:"~ìœ„ì—, ~ë„˜ëŠ”", a:"over"},
        {q:"ë…¸ë˜í•˜ë‹¤", a:"sing"}, {q:"ì˜ì‚¬", a:"doctor"}, {q:"íŠ¹ë³„í•œ", a:"special"}, {q:"ì•½í•œ", a:"weak"},
        {q:"ê³„ë‹¨", a:"stair"}, {q:"ì–´ëŠ ê²ƒ", a:"which"}, {q:"ê¸¸, ë„ë¡œ", a:"road"}, {q:"ë¶€ì—Œ", a:"kitchen"},
        {q:"ê°„ì‹", a:"snack"}, {q:"í•œ ìŒ, ì¼¤ë ˆ", a:"pair"}, {q:"ìš”ì¦˜", a:"these days"}, {q:"ì´í•´í•˜ë‹¤", a:"get it"}
      ],
      sentences: [
        {q:"(ê·¸ë…€ëŠ” ì¼ê³¼ í•™ì—…ìœ¼ë¡œ ë°”ì˜ë‹¤) She is [ ______ ] with work and study.", a:"busy"},
        {q:"(ë‚˜ëŠ” ë§¤ì¼ ì¼ì° ì¼ì–´ë‚œë‹¤) I get up [ ______ ] every day.", a:"early"},
        {q:"(ê·¸ëŠ” í•œêµ­ ìŒì‹ì„ ì¢‹ì•„í•œë‹¤) He likes Korean [ ______ ].", a:"food"},
        {q:"(ê±°ì˜ 4ì‹œê°€ ë‹¤ ë˜ì–´ê°„ë‹¤) It's [ ______ ] four o'clock.", a:"almost"},
        {q:"(ì œê°€ ì¹œêµ¬ë¥¼ ì§‘ì— ë°ë ¤ì™€ë„ ë ê¹Œìš”?) Can I [ ______ ] a friend home?", a:"bring"},
        {q:"(ì•„ë“¤ì´ ë²½ì— ë™ë¬¼ë“¤ì„ ê·¸ë ¸ë‹¤) My son [ ______ ] animals on the wall.", a:"drew"},
        {q:"(í•œ ì—¬ìê°€ ê¸¸ì„ ê±´ë„ˆê³  ìˆë‹¤) A woman is [ ______ ] the street.", a:"crossing"},
        {q:"(ì‚° ìœ„ë¡œ êµ¬ë¦„ì´ ë–  ìˆë‹¤) There are clouds [ ______ ] the mountain.", a:"over"},
        {q:"(ê·¸ë“¤ì€ ë°©ê³¼ í›„ì— ë…¸ë˜í–ˆë‹¤) They [ ______ ] after school.", a:"sang"},
        {q:"(ì˜ì‚¬ëŠ” ë¬¼ì„ ë§ˆì‹œë¼ê³  í–ˆë‹¤) The [ ______ ] told me to drink water.", a:"doctor"},
        {q:"(íŠ¹ë³„ ë©”ë‰´ê°€ ìˆë‚˜ìš”?) Do you have a [ ______ ] menu?", a:"special"},
        {q:"(í• ë¨¸ë‹ˆëŠ” ë‹¤ë¦¬ê°€ ì•½í•˜ì‹œë‹¤) My grandmother has [ ______ ] legs.", a:"weak"},
        {q:"(ê·¸ëŠ” ê³„ë‹¨ì„ ì˜¬ë¼ê°”ë‹¤) He went up the [ ______ ].", a:"stairs"},
        {q:"(ì–´ë–¤ ê²ƒì´ ë„¤ ì±…ì´ë‹ˆ?) [ ______ ] is your book?", a:"Which"},
        {q:"(ë„ë¡œì— ì°¨ë“¤ì´ ë§ë‹¤) There are a lot of cars on the [ ______ ].", a:"road"},
        {q:"(ê·¸ë…€ëŠ” ë¶€ì—Œì—ì„œ ìš”ë¦¬ì¤‘ì´ë‹¤) She is cooking in the [ ______ ].", a:"kitchen"},
        {q:"(ë‚˜ëŠ” ê°„ì‹ìœ¼ë¡œ ì´ˆì½œë¦¿ì„ ì¢‹ì•„í•œë‹¤) I like chocolate for a [ ______ ].", a:"snack"},
        {q:"(ê·¸ë…€ëŠ” ìƒˆ ì•ˆê²½ í•˜ë‚˜ë¥¼ ìƒ€ë‹¤) She bought a new [ ______ ] of glasses.", a:"pair"},
        {q:"(ìš”ì¦˜ ë‚ ì”¨ê°€ ì¢‹ë‹¤) The weather is nice [ ______ ] [ ______ ].", a:"these days"},
        {q:"(ì €ëŠ” ì´í•´ë¥¼ ëª»í•˜ê² ì–´ìš”) I don't [ ______ ] [ ______ ].", a:"get it"}
      ]
    },
    {
      title: "Day 18 (0341~0360)",
      words: [
        {q:"ë³‘, í•œ ë³‘", a:"bottle"}, {q:"ì‹œê³„", a:"clock"}, {q:"ê¿ˆ, ê¿ˆê¾¸ë‹¤", a:"dream"}, {q:"ì™„ì „í•œ, ì™„ë£Œí•˜ë‹¤", a:"complete"},
        {q:"ê³„ì ˆ", a:"season"}, {q:"ì£½ë‹¤", a:"die"}, {q:"ê°€ê²Œ", a:"store"}, {q:"ë–¨ì–´ì ¸, ë©€ë¦¬", a:"off"},
        {q:"íŒ”ë‹¤", a:"sell"}, {q:"ì…", a:"mouth"}, {q:"ì¥ê°‘", a:"glove"}, {q:"ì ‘ì‹œ", a:"dish"},
        {q:"ì‹¬ì¥, ë§ˆìŒ", a:"heart"}, {q:"ê·¸ë¦¼, ì‚¬ì§„", a:"picture"}, {q:"ì, ë‚˜ë­‡ì", a:"leaf"}, {q:"ë³‘ì›", a:"hospital"},
        {q:"ë‹¤ë¦¬", a:"bridge"}, {q:"ìœ ìš©í•œ", a:"useful"}, {q:"ì§„ì°°ë°›ë‹¤", a:"see a doctor"}, {q:"ì§‘ë‹¤, íƒœìš°ë‹¤", a:"pick up"}
      ],
      sentences: [
        {q:"(ì´ ë³‘ ì¢€ ì—´ì–´ì£¼ì‹œê² ì–´ìš”?) Would you open this [ ______ ]?", a:"bottle"},
        {q:"(ì´ ì‹œê³„ëŠ” 5ë¶„ ë¹ ë¥´ë‹¤) This [ ______ ] is five minutes fast.", a:"clock"},
        {q:"(ê·¸ëŠ” ì•…ëª½ì„ ê¾¸ì—ˆë‹¤) He had a bad [ ______ ].", a:"dream"},
        {q:"(ìš°ë¦¬ëŠ” ì¼ì„ ì™„ë£Œí•´ì•¼ í•œë‹¤) We should [ ______ ] the work.", a:"complete"},
        {q:"(ì–´ë–¤ ê³„ì ˆì„ ì¢‹ì•„í•˜ë‹ˆ?) Which [ ______ ] do you like?", a:"season"},
        {q:"(ê·¸ ê°œëŠ” ì‘ë…„ì— ì£½ì—ˆë‹¤) The dog [ ______ ] last year.", a:"died"},
        {q:"(ê°€ê²Œì—ì„œ ë‹¬ê±€ì„ ì‚¬ë¼) Buy eggs at the [ ______ ].", a:"store"},
        {q:"(ê·¸ëŠ” ë§ì—ì„œ ë–¨ì–´ì¡Œë‹¤) He fell [ ______ ] the horse.", a:"off"},
        {q:"(ì´ ê°€ê²ŒëŠ” ëª¨ìë¥¼ íŒë‹¤) This store [ ______ ] caps.", a:"sells"},
        {q:"(ì…ì„ ë²Œë ¤ë¼) Open your [ ______ ].", a:"mouth"},
        {q:"(ë‚˜ëŠ” ì¥ê°‘ì„ ê¼ˆë‹¤) I put on [ ______ ].", a:"gloves"},
        {q:"(ê·¸ë…€ëŠ” ì ‘ì‹œë¥¼ ìƒ€ë‹¤) She bought a [ ______ ].", a:"dish"},
        {q:"(ê·¸ëŠ” ì‹¬ì¥ì´ ì•½í•˜ë‹¤) He has a weak [ ______ ].", a:"heart"},
        {q:"(ë‚˜ëŠ” ê·¸ë¦¼ì„ ê·¸ë¦¬ê³  ìˆë‹¤) I'm drawing a [ ______ ].", a:"picture"},
        {q:"(ë‚˜ë­‡ìë“¤ì´ ë¹¨ê°›ë‹¤) [ ______ ] are red.", a:"Leaves"},
        {q:"(ë³‘ì›ì— ì•„í”ˆ ì•„ì´ë“¤ì´ ë§ë‹¤) Many sick children at the [ ______ ].", a:"hospital"},
        {q:"(ë‚˜ëŠ” ë‹¤ë¦¬ë¥¼ ê±´ë„œë‹¤) I crossed the [ ______ ].", a:"bridge"},
        {q:"(ì´ ìˆ˜ì—…ì€ ìœ ìš©í•  ê²ƒì´ë‹¤) This class will be [ ______ ].", a:"useful"},
        {q:"(ë„ˆëŠ” ë³‘ì›ì— ê°€ì•¼í•´) You should [ ______ ] [ ______ ] [ ______ ].", a:"see a doctor"},
        {q:"(ê·¸ë…€ëŠ” ì±…ì„ ì§‘ì—ˆë‹¤) She [ ______ ] [ ______ ] a book.", a:"picked up"}
      ]
    },
    {
      title: "Day 19 (0361~0380)",
      words: [
        {q:"ë‚˜ì´", a:"age"}, {q:"ëª©ìš•", a:"bath"}, {q:"ì‚¬ì´Œ", a:"cousin"}, {q:"ì¦ê¸°ë‹¤", a:"enjoy"},
        {q:"ë¬»ë‹¤, ìš”ì²­í•˜ë‹¤", a:"ask"}, {q:"ë‹¨ì§€, ì˜¤ì§", a:"only"}, {q:"ê°€ì ¸ê°€ë‹¤", a:"take"}, {q:"~ì•ˆìœ¼ë¡œ", a:"into"},
        {q:"ë¹µ", a:"bread"}, {q:"ì”»ë‹¤", a:"wash"}, {q:"í™•ì‹ í•˜ëŠ”", a:"sure"}, {q:"ì‹ ë°œ", a:"shoe"},
        {q:"ë°”ëŒ", a:"wind"}, {q:"ê°’ì´ ì‹¼", a:"cheap"}, {q:"ì‚¬ë‘í•˜ë‹¤", a:"love"}, {q:"ë‚¨í¸", a:"husband"},
        {q:"ì±„ì†Œ, ì•¼ì±„", a:"vegetable"}, {q:"ê°€ë¥´ì¹˜ë‹¤", a:"teach"}, {q:"ì„¤ê±°ì§€ë¥¼ í•˜ë‹¤", a:"do the dishes"}, {q:"ëë‚˜ë‹¤", a:"be over"}
      ],
      sentences: [
        {q:"(ê·¸ëŠ” 70ì„¸ì˜ ë‚˜ì´ë¡œ ì£½ì—ˆë‹¤) He died at the [ ______ ] of 70.", a:"age"},
        {q:"(ë‚´ ê°œëŠ” ëª©ìš•ì„ ì‹«ì–´í•œë‹¤) My dog hates [ ______ ].", a:"baths"},
        {q:"(ì € ì†Œë…„ì€ ë‚´ ì‚¬ì´Œì´ë‹¤) That boy is my [ ______ ].", a:"cousin"},
        {q:"(ê·¸ë…€ëŠ” ìŒì•…ì„ ì¦ê¸°ê³  ìˆë‹¤) She is [ ______ ] the music.", a:"enjoying"},
        {q:"(ì œê°€ ë‹¹ì‹ ì˜ ì´ë¦„ì„ ë¬¼ì–´ë„ ë ê¹Œìš”?) May I [ ______ ] your name?", a:"ask"},
        {q:"(ë‚˜ëŠ” ë‹¨ì§€ 10ë¶„ ëŠ¦ì—ˆì„ ë¿ì´ë‹¤) I was [ ______ ] ten minutes late.", a:"only"},
        {q:"(ë‚˜ëŠ” ë‚´ ê°€ë°©ì„ ë°©ìœ¼ë¡œ ê°€ì ¸ê°”ë‹¤) I [ ______ ] my bag to my room.", a:"took"},
        {q:"(ê·¸ë…€ëŠ” ë³‘ì› ì•ˆìœ¼ë¡œ ê±¸ì–´ ë“¤ì–´ê°”ë‹¤) She walked [ ______ ] the hospital.", a:"into"},
        {q:"(ê·¸ë“¤ì€ ìˆ˜í”„ì™€ ë¹µì„ ë¨¹ì—ˆë‹¤) They ate some [ ______ ] with soup.", a:"bread"},
        {q:"(ì €ë… ì‹ì‚¬ ì „ì— ì†ì„ ì”»ì–´ë¼) [ ______ ] your hands before dinner.", a:"Wash"},
        {q:"(ìš°ë¦¬ëŠ” ê·¸ê²ƒì— ëŒ€í•´ í™•ì‹ í•˜ì§€ ëª»í•œë‹¤) We are not [ ______ ] about that.", a:"sure"},
        {q:"(ì–‘ë§ê³¼ ì‹ ë°œì„ ì‹ ì–´ë¼) Put on your socks and [ ______ ].", a:"shoes"},
        {q:"(ì–´ì œëŠ” ë°”ëŒì´ ì •ë§ ê°•í–ˆë‹¤) The [ ______ ] was really strong yesterday.", a:"wind"},
        {q:"(ê·¸ ì•¼êµ¬ ì¥ê°‘ì€ ì‹¸ë‹¤) The baseball glove is [ ______ ].", a:"cheap"},
        {q:"(ê·¸ë…€ëŠ” ê·¸ë…€ì˜ ë”¸ì„ ë§¤ìš° ì‚¬ë‘í•œë‹¤) She [ ______ ] her daughter very much.", a:"loves"},
        {q:"(ê·¸ëŠ” ì œë‹ˆì˜ ë‚¨í¸ì´ë‹¤) He is Jenny's [ ______ ].", a:"husband"},
        {q:"(ê°ìëŠ” ì±„ì†Œì˜ ì¼ì¢…ì´ë‹¤) Potatoes are a kind of [ ______ ].", a:"vegetable"},
        {q:"(ë‚˜ëŠ” í•œêµ­ í•™ìƒë“¤ì—ê²Œ ì˜ì–´ë¥¼ ê°€ë¥´ì¹œë‹¤) I [ ______ ] English to Korean students.", a:"teach"},
        {q:"(ì•„ë¹ ëŠ” ë§¤ì¼ ì„¤ê±°ì§€ë¥¼ í•˜ì‹ ë‹¤) Dad [ ______ ] [ ______ ] [ ______ ] every day.", a:"does the dishes"},
        {q:"(ê·¸ ì½˜ì„œíŠ¸ëŠ” 9ì‹œì— ëë‚  ê²ƒì´ë‹¤) The concert will [ ______ ] [ ______ ] at nine.", a:"be over"}
      ]
    },
    {
      title: "Day 20 (0381~0400)",
      words: [
        {q:"ì˜ˆìˆ , ë¯¸ìˆ ", a:"art"}, {q:"ë³´ì—¬ì£¼ë‹¤, ì‡¼", a:"show"}, {q:"ë¹„í–‰ê¸°", a:"airplane"}, {q:"~ì´ ë˜ë‹¤", a:"become"},
        {q:"ë°°, ë³´íŠ¸", a:"boat"}, {q:"ì§ˆë¬¸", a:"question"}, {q:"ë³´ë‚´ë‹¤", a:"send"}, {q:"~ì•ˆì—, ì•ˆ", a:"inside"},
        {q:"ë›°ë‹¤, ë›°ì–´ì˜¤ë¥´ë‹¤", a:"jump"}, {q:"ë°°ìš°ë‹¤", a:"learn"}, {q:"ì‚¬ì‹¤ì¸, ì§„ì§œì˜", a:"true"}, {q:"ì›€ì§ì´ë‹¤", a:"move"},
        {q:"ë””ì €íŠ¸, í›„ì‹", a:"dessert"}, {q:"ì •ì‚¬ê°í˜•, ê´‘ì¥", a:"square"}, {q:"ì„¸ê³„", a:"world"}, {q:"ì‹ë‹¹", a:"restaurant"},
        {q:"ì†Œí’", a:"picnic"}, {q:"ê°€ê²Œ, ë¬¼ê±´ì„ ì‚¬ë‹¤", a:"shop"}, {q:"ë¶„ëª…íˆ, í™•ì‹¤íˆ", a:"for sure"}, {q:"êµ¬ê²½ì‹œì¼œ ì£¼ë‹¤", a:"show around"}
      ],
      sentences: [
        {q:"(ìŒì•…ì€ ì˜ˆìˆ ì˜ ì¼ì¢…ì´ë‹¤) Music is a kind of [ ______ ].", a:"art"},
        {q:"(ê·¸ëŠ” ë‚˜ì—ê²Œ ìì‹ ì˜ ì‚¬ì§„ì„ ë³´ì—¬ì£¼ì—ˆë‹¤) He [ ______ ] me his picture.", a:"showed"},
        {q:"(ë‚˜ëŠ” ë¹„í–‰ê¸°ë¥¼ íƒ€ê³  ì¤‘êµ­ì— ê°”ë‹¤) I went to China by [ ______ ].", a:"airplane"},
        {q:"(ê·¸ë“¤ì€ 7ì›”ì— ë¶€ëª¨ê°€ ë  ê²ƒì´ë‹¤) They will [ ______ ] parents in July.", a:"become"},
        {q:"(ë³´íŠ¸ í•œ ì²™ì´ í˜¸ìˆ˜ì— ìˆì—ˆë‹¤) A [ ______ ] was on the lake.", a:"boat"},
        {q:"(ë‚˜ëŠ” ê·¸ ì‹œí—˜ì— ê´€í•´ ì§ˆë¬¸ì´ ìˆë‹¤) I have a [ ______ ] about the test.", a:"question"},
        {q:"(ë‚˜ëŠ” ê·¸ì—ê²Œ ìƒì¼ ì¹´ë“œë¥¼ ë³´ëƒˆë‹¤) I [ ______ ] a birthday card to him.", a:"sent"},
        {q:"(ì¶¥ë‹¤! ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ì) It's cold! Let's go [ ______ ].", a:"inside"},
        {q:"(ê·¸ë“¤ì€ ë¬¼ì†ìœ¼ë¡œ ë›°ì–´ë“¤ì—ˆë‹¤) They [ ______ ] into the water.", a:"jumped"},
        {q:"(ê·¸ë…€ëŠ” í•™êµì—ì„œ ì¤‘êµ­ì–´ë¥¼ ë°°ì› ë‹¤) She [ ______ ] Chinese at school.", a:"learned"},
        {q:"(ê·¸ ì´ì•¼ê¸°ëŠ” ì‚¬ì‹¤ì´ ì•„ë‹ˆì—ˆë‹¤) The story was not [ ______ ].", a:"true"},
        {q:"(ë‚˜ëŠ” ì†ê°€ë½ì„ ì›€ì§ì¼ ìˆ˜ê°€ ì—†ë‹¤) I can't [ ______ ] my finger. ", a:"move"},
        {q:"(ë‚˜ëŠ” ë””ì €íŠ¸ë¡œ ì• í”ŒíŒŒì´ë¥¼ ë¨¹ì—ˆë‹¤) I had apple pie for [ ______ ].", a:"dessert"},
        {q:"(ë¹µì„ ì •ì‚¬ê°í˜•ìœ¼ë¡œ ì˜ë¼ë¼) Cut the bread into [ ______ ].", a:"squares"},
        {q:"(ì„¸ê³„ì—ëŠ” ë§ì€ êµ­ê°€ë“¤ì´ ìˆë‹¤) There are many countries in the [ ______ ].", a:"world"},
        {q:"(ìš°ë¦¬ëŠ” í”„ë‘ìŠ¤ ì‹ë‹¹ì—ì„œ ì ì‹¬ì„ ë¨¹ì—ˆë‹¤) We had lunch at a French [ ______ ].", a:"restaurant"},
        {q:"(ì´ë²ˆ ì£¼ í† ìš”ì¼ì— ì†Œí’ì„ ê°€ì) Let's go on a [ ______ ] this Saturday.", a:"picnic"},
        {q:"(ì €ìª½ì— ê½ƒ ê°€ê²Œê°€ ìˆë‹¤) There is a flower [ ______ ] over there. ", a:"shop"},
        {q:"(ìš°ë¦¬ëŠ” ê·¸ì˜ ë‚˜ì´ë¥¼ í™•ì‹¤íˆ ëª¨ë¥¸ë‹¤) We don't know his age [ ______ ] [ ______ ].", a:"for sure"},
        {q:"(ë‚´ê°€ ë„ˆì—ê²Œ ìš°ë¦¬ ë§ˆì„ì„ êµ¬ê²½ì‹œì¼œ ì¤„ê²Œ) I will [ ______ ] you [ ______ ] my town.", a:"show around"}
      ]
    },
    {
      title: "Day 21 (0401~0420)",
      words: [
        {q:"ë„ì°©í•˜ë‹¤", a:"arrive"}, {q:"ìš•ì‹¤, í™”ì¥ì‹¤", a:"bathroom"}, {q:"ìƒì, ìš©ê¸°", a:"case"}, {q:"ë„ì„œê´€", a:"library"},
        {q:"ì˜¨ë¼ì¸ì˜", a:"online"}, {q:"ë˜‘ë°”ë¡œ, ê³§ì¥", a:"straight"}, {q:"ë…¸ë ¥í•˜ë‹¤, ì‹œë„í•˜ë‹¤", a:"try"}, {q:"ê°€ê¹Œìš´, ê°€ê¹Œì´", a:"near"},
        {q:"ì‹œì‘í•˜ë‹¤", a:"begin"}, {q:"ëë‚˜ë‹¤, ëë§ˆì¹˜ë‹¤", a:"finish"}, {q:"ë‘˜ ë‹¤ì˜, ì–‘ìª½", a:"both"}, {q:"ì‹ ì†í•œ, ë¹ ë¥¸", a:"quick"},
        {q:"ë¶€ìœ í•œ, ë¶€ìì¸", a:"rich"}, {q:"ì„œ ìˆë‹¤, ì„œë‹¤", a:"stand"}, {q:"ë¯¸ì•ˆí•œ, ìœ ê°ìŠ¤ëŸ¬ìš´", a:"sorry"}, {q:"ìˆ˜ì—…, êµí›ˆ", a:"lesson"},
        {q:"ì ì—ì„œ ê¹¨ë‹¤", a:"wake"}, {q:"~í•˜ê²Œ í•˜ë‹¤, í—ˆë½í•˜ë‹¤", a:"let"}, {q:"ì´ë£¨ì–´ì§€ë‹¤", a:"come true"}, {q:"í•œ ì‚¬ëŒì”©", a:"one by one"}
      ],
      sentences: [
        {q:"(ê¸°ì°¨ê°€ ì„œìš¸ì— ë„ì°©í–ˆë‹¤) The train [ ______ ] in Seoul at four.", a:"arrived"},
        {q:"(ìš•ì‹¤ì—ì„œ ì„¸ìˆ˜ë¥¼ í•´ë¼) Wash your face in the [ ______ ].", a:"bathroom"},
        {q:"(í•„í†µì— ì—°í•„ ë‘ ìë£¨ê°€ ìˆë‹¤) There are two pens in the pencil [ ______ ].", a:"case"},
        {q:"(ë‚˜ëŠ” ë„ì„œê´€ì—ì„œ ìì£¼ ì±…ì„ ì½ëŠ”ë‹¤) I often read books in the [ ______ ].", a:"library"},
        {q:"(ê·¸ë“¤ì€ ë§¤ì¼ ì˜¨ë¼ì¸ ê²Œì„ì„ í•œë‹¤) They play [ ______ ] games every day.", a:"online"},
        {q:"(ê·¸ë…€ëŠ” ê·¸ì—ê²Œ ë˜‘ë°”ë¡œ ê±¸ì–´ê°”ë‹¤) She walked [ ______ ] to him.", a:"straight"},
        {q:"(ê·¸ëŠ” ê·¸ ì¼ì„ ì™„ìˆ˜í•˜ê¸° ìœ„í•´ ë…¸ë ¥í–ˆë‹¤) He [ ______ ] to complete the work.", a:"tried"},
        {q:"(ë³‘ì›ì€ ë§¤ìš° ê°€ê¹ë‹¤) The hospital is very [ ______ ].", a:"near"},
        {q:"(ê·¸ ì˜í™”ëŠ” 7ì‹œì— ì‹œì‘í•œë‹¤) The movie [ ______ ] at seven.", a:"begins"},
        {q:"(ëª¨ë“  ìˆ˜ì—…ì€ ì˜¤í›„ 5ì‹œì— ëë‚œë‹¤) All classes [ ______ ] at 5 p.m.", a:"finish"},
        {q:"(ë‘ ì†Œë…„ë“¤ì€ ì˜ì–´ë¥¼ ë§í•  ìˆ˜ ìˆë‹¤) [ ______ ] the boys can speak English.", a:"Both"},
        {q:"(ë²„ìŠ¤ë¥¼ íƒ€ê³  ê°€ëŠ” ê²ƒì´ ë¹ ë¥´ë‹¤) It is [ ______ ] to go by bus.", a:"quick"},
        {q:"(ê·¸ ë…¸ë¶€ì¸ì€ ë§¤ìš° ë¶€ìœ í•˜ë‹¤) The old lady is very [ ______ ].", a:"rich"},
        {q:"(ê·¸ëŠ” ë¬¸ê°€ì— ì„œ ìˆì—ˆë‹¤) He was [ ______ ] at the door.", a:"standing"},
        {q:"(ì–´ì œ ì¼ì€ ë‚´ê°€ ë¯¸ì•ˆí•˜ë‹¤) I'm [ ______ ] about yesterday.", a:"sorry"},
        {q:"(ë‚˜ëŠ” ë°©ê³¼ í›„ì— í”¼ì•„ë…¸ ìˆ˜ì—…ì„ ë°›ëŠ”ë‹¤) I take piano [ ______ ] after school.", a:"lessons"},
        {q:"(ê·¸ë…€ëŠ” 7ì‹œ 30ë¶„ì— ì¼ì–´ë‚œë‹¤) She [ ______ ] up at 7:30.", a:"wake"},
        {q:"(ê·¸ëŠ” ë‚´ê°€ ê·¸ì˜ íœì„ ì“°ê²Œ í–ˆë‹¤) He [ ______ ] me use his pen.", a:"let"},
        {q:"(ë„ˆì˜ ê¿ˆì€ ì´ë£¨ì–´ì§ˆ ê²ƒì´ë‹¤) Your dream will [ ______ ] [ ______ ].", a:"come true"},
        {q:"(ê·¸ë“¤ì€ í•œ ì‚¬ëŒì”© ë°©ìœ¼ë¡œ ë“¤ì–´ê°”ë‹¤) They entered the room [ ______ ] [ ______ ] [ ______ ].", a:"one by one"}
      ]
    },
    {
      title: "Day 22 (0421~0440)",
      words: [
        {q:"ëŒë‹¤, ëŒë¦¬ë‹¤", a:"turn"}, {q:"ê³µí•­", a:"airport"}, {q:"ì¡ë‹¤, ê±¸ë¦¬ë‹¤", a:"catch"}, {q:"ì˜ˆìœ", a:"pretty"},
        {q:"ì•„ì¹¨ ì‹ì‚¬", a:"breakfast"}, {q:"ì—¬í–‰", a:"trip"}, {q:"ì–¸ë•, ì‚°", a:"hill"}, {q:"~í•  ë•Œ, ~í•˜ë©´ì„œ", a:"as"},
        {q:"ì‹œì‘í•˜ë‹¤", a:"begin"}, {q:"ëë‚˜ë‹¤, ëë§ˆì¹˜ë‹¤", a:"finish"}, {q:"ë‘˜ ë‹¤ì˜", a:"both"}, {q:"ì‹ ì†í•œ, ë¹ ë¥¸", a:"quick"},
        {q:"ë¶€ìœ í•œ, ë¶€ìì¸", a:"rich"}, {q:"ì„œ ìˆë‹¤", a:"stand"}, {q:"ë¯¸ì•ˆí•œ, ìœ ê°ìŠ¤ëŸ¬ìš´", a:"sorry"}, {q:"ìˆ˜ì—…", a:"lesson"},
        {q:"ì ì—ì„œ ê¹¨ë‹¤", a:"wake"}, {q:"ì¶œì…ë¬¸, íƒ‘ìŠ¹êµ¬", a:"gate"}, {q:"~ì„ ì…ì–´ë³´ë‹¤", a:"try on"}, {q:"í†µí™”í•˜ë‹¤", a:"talk on the phone"}
      ],
      sentences: [
        {q:"(ì™¼ìª½ìœ¼ë¡œ ëŒì•„ë¼) [ ______ ] left.", a:"Turn"},
        {q:"(ë¹„í–‰ê¸°ê°€ 6ì‹œì— ê³µí•­ì— ë„ì°©í•  ê²ƒì´ë‹¤) The plane will arrive at the [ ______ ] at six.", a:"airport"},
        {q:"(ë‚˜ëŠ” ë‘ ì†ìœ¼ë¡œ ê·¸ ê³µì„ ì¡ì•˜ë‹¤) I [ ______ ] the ball with both hands.", a:"caught"},
        {q:"(ë‚´ ì—¬ë™ìƒì€ ì˜ˆì˜ë‹¤) My sister is [ ______ ].", a:"pretty"},
        {q:"(ë„ˆëŠ” ì•„ì¹¨ ì‹ì‚¬ë¡œ ë¬´ì—‡ì„ ë¨¹ê³  ì‹¶ë‹ˆ?) What do you want for [ ______ ]?", a:"breakfast"},
        {q:"(ë¶€ì‚° ì—¬í–‰ì€ ì–´ë• ë‹ˆ?) How was your [ ______ ] to Busan?", a:"trip"},
        {q:"(ê·¸ë“¤ì€ ì–¸ë•ì„ ê±¸ì–´ ì˜¬ë¼ê°”ë‹¤) They walked up the [ ______ ].", a:"hill"},
        {q:"(ë‚˜ëŠ” ì €ë…ì„ ì¤€ë¹„í•  ë•Œ TVë¥¼ ë³´ì•˜ë‹¤) He watched TV [ ______ ] I cooked dinner.", a:"as"},
        {q:"(ê·¸ ì˜í™”ëŠ” 7ì‹œì— ì‹œì‘í•œë‹¤) The movie [ ______ ] at seven.", a:"begins"},
        {q:"(ëª¨ë“  ìˆ˜ì—…ì€ ì˜¤í›„ 5ì‹œì— ëë‚œë‹¤) All classes [ ______ ] at 5 p.m.", a:"finish"},
        {q:"(ë‘ ì†Œë…„ë“¤ì€ ì˜ì–´ë¥¼ ë§í•  ìˆ˜ ìˆë‹¤) [ ______ ] the boys can speak English.", a:"Both"},
        {q:"(ë²„ìŠ¤ë¥¼ íƒ€ê³  ê°€ëŠ” ê²ƒì´ ë¹ ë¥´ë‹¤) It is [ ______ ] to go by bus.", a:"quick"},
        {q:"(ê·¸ ë…¸ë¶€ì¸ì€ ë§¤ìš° ë¶€ìœ í•˜ë‹¤) The old lady is very [ ______ ].", a:"rich"},
        {q:"(ê·¸ëŠ” ë¬¸ê°€ì— ì„œ ìˆì—ˆë‹¤) He was [ ______ ] at the door.", a:"standing"},
        {q:"(ì–´ì œ ì¼ì€ ë‚´ê°€ ë¯¸ì•ˆí•˜ë‹¤) I'm [ ______ ] about yesterday.", a:"sorry"},
        {q:"(ë‚˜ëŠ” ë°©ê³¼ í›„ì— í”¼ì•„ë…¸ ìˆ˜ì—…ì„ ë°›ëŠ”ë‹¤) I take piano [ ______ ] after school.", a:"lessons"},
        {q:"(ê·¸ë…€ëŠ” 7ì‹œ 30ë¶„ì— ì¼ì–´ë‚œë‹¤) She [ ______ ] up at 7:30.", a:"wakes"},
        {q:"(ìš°ë¦¬ëŠ” 20ë²ˆ íƒ‘ìŠ¹êµ¬ì—ì„œ ë¹„í–‰ê¸°ì— íƒ‘ìŠ¹í–ˆë‹¤) We boarded the plane at [ ______ ] 20.", a:"Gate"},
        {q:"(ì œê°€ ì´ ì¹˜ë§ˆë¥¼ ì…ì–´ë´ë„ ë ê¹Œìš”?) Can I [ ______ ] [ ______ ] this skirt?", a:"try on"},
        {q:"(ê·¸ë…€ëŠ” ì§€ê¸ˆ í†µí™” ì¤‘ì´ë‹¤) She is [ ______ ] [ ______ ] [ ______ ] [ ______ ] now.", a:"talking on the phone"}
      ]
    }
  ];

  let library = defaultData; 
  let currentSet = {};
  let studyList = [];
  let wrongList = [];
  let currentIndex = 0;
  let currentMode = 1;
  let editingIndex = -1;

  function init() { renderLibrary(); }
  function renderLibrary() {
    const con = document.getElementById('saved-list-container');
    con.innerHTML = "";
    library.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'list-item';
        div.innerHTML = `
            <div class="list-info" onclick="openStudy(${idx})">
                <div class="list-title">${item.title}</div>
                <div class="list-desc">ë‹¨ì–´ ${item.words.length}ê°œ / ì˜ˆë¬¸ ${item.sentences.length}ê°œ</div>
            </div>
            <div class="btn-group">
                <button class="btn btn-edit" style="padding:5px 10px;" onclick="editItem(${idx})">ìˆ˜ì •</button>
                <button class="btn btn-danger" style="font-size:12px; padding:5px 10px;" onclick="delItem(${idx})">ì‚­ì œ</button>
            </div>
        `;
        con.appendChild(div);
    });
  }
  function delItem(idx) { if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { library.splice(idx, 1); renderLibrary(); } }

  // === ì…ë ¥/ìˆ˜ì • ë¡œì§ ===
  function showInputScreen() { showScreen('screen-input'); editingIndex = -1; document.getElementById('input-title').innerText = "âœ¨ ìƒˆ ë‹¨ì–´ì¥ ë§Œë“¤ê¸°"; document.getElementById('listTitle').value = ""; document.getElementById('inputWords').value = ""; document.getElementById('inputSentences').value = ""; }
  function editItem(idx) {
    showScreen('screen-input'); editingIndex = idx; document.getElementById('input-title').innerText = "âœï¸ ë‹¨ì–´ì¥ ìˆ˜ì •í•˜ê¸°";
    const item = library[idx];
    document.getElementById('listTitle').value = item.title;
    document.getElementById('inputWords').value = item.words.map(w => `${w.a}\t${w.q}`).join('\n');
    document.getElementById('inputSentences').value = item.sentences.map(s => `${s.a}\t${s.q}`).join('\n');
  }
  function saveAndStart() {
    const title = document.getElementById('listTitle').value.trim();
    const wText = document.getElementById('inputWords').value.trim();
    const sText = document.getElementById('inputSentences').value.trim();
    if(!title) return alert("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!");
    const words = parseText(wText);
    const sentences = parseText(sText);
    const newItem = { title, words, sentences };
    if(editingIndex === -1) { library.push(newItem); openStudy(library.length - 1); } 
    else { library[editingIndex] = newItem; openStudy(editingIndex); }
  }
  function parseText(text) {
    if(!text) return [];
    return text.split('\n').map(line => {
        line = line.trim(); if(!line) return null;
        let parts = line.split(/[\t]+| {2,}/);
        if(parts.length < 2 && line.includes(' ')) { let idx = line.indexOf(' '); parts = [line.substring(0, idx), line.substring(idx+1)]; }
        if(parts.length >= 2) return { q: parts[1].trim(), a: parts[0].trim() };
        return null;
    }).filter(x => x);
  }

  function openStudy(idx) { currentSet = library[idx]; document.getElementById('study-title').innerText = currentSet.title; showScreen('screen-study'); changeMode(1); }
  function changeMode(mode) {
    currentMode = mode;
    [1,2,3,4].forEach(n => document.getElementById(`m${n}`).className = 'mode-btn' + (n===mode ? ' selected' : ''));
    if(mode === 1 || mode === 2) studyList = [...currentSet.words];
    else {
        studyList = [...currentSet.sentences];
        if(studyList.length === 0) { alert("ì˜ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤."); changeMode(1); return; }
    }
    resetCurrentMode();
  }
  function resetCurrentMode() { currentIndex = 0; wrongList = []; document.getElementById('result-box').style.display = 'none'; const isCard = (currentMode === 1 || currentMode === 3); document.getElementById('card-area').style.display = isCard ? 'block' : 'none'; document.getElementById('quiz-area').style.display = isCard ? 'none' : 'block'; showItem(); }
  function shuffleCurrent() { studyList.sort(() => Math.random() - 0.5); resetCurrentMode(); }

  // === í™”ë©´ í‘œì‹œ (ì˜ˆë¬¸ ì¹´ë“œ ë’¤ì§‘ìœ¼ë©´ ë¹¨ê°„ ì •ë‹µ ì™!) ===
  function showItem() {
    if(currentIndex >= studyList.length) { finishStudy(); return; }
    const item = studyList[currentIndex];
    document.getElementById('status-display').innerText = `${currentIndex + 1} / ${studyList.length}`;

    if(currentMode === 1) { // ë‹¨ì–´ ì¹´ë“œ
        renderCard(item.a, item.q, true); 
    } else if(currentMode === 3) { // ì˜ˆë¬¸ ì¹´ë“œ
        // ì•ë©´: ì˜ì–´ ë¬¸ì¥ + í•œê¸€ í•´ì„ (íŒŒë€ìƒ‰)
        let match = item.q.match(/\(([^)]+)\)/); 
        let kor = ""; let eng = item.q;
        if(match) { kor = match[1]; eng = item.q.replace(match[0], "").trim(); }
        
        // ë’·ë©´: ë¹ˆì¹¸ì´ ì±„ì›Œì§„ ë¬¸ì¥ (ë¹¨ê°„ìƒ‰ ì •ë‹µ)
        // [ _____ ] ë¶€ë¶„ì„ [ ì •ë‹µ ] í˜•íƒœë¡œ ì¹˜í™˜ (ë¹¨ê°„ìƒ‰ íƒœê·¸ í¬í•¨)
        let filledSentence = eng.replace(/\[\s*______\s*\]/, `[ <span style='color:red'>${item.a}</span> ]`);
        // ì •ë‹µì´ 2ê°œ ì´ìƒì¸ ë¹ˆì¹¸ (ì˜ˆ: [ ___ ] [ ___ ]) ì²˜ë¦¬
        // ë‹¨ìˆœí•˜ê²Œ í•˜ë ¤ë©´ ëª¨ë“  ë¹ˆì¹¸ì„ ì •ë‹µìœ¼ë¡œ ì±„ì›Œì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„  aê°€ í†µì§¸ë¡œ ì •ë‹µì´ë¯€ë¡œ
        // ì²« ë²ˆì§¸ ë¹ˆì¹¸ì„ ì •ë‹µìœ¼ë¡œ ë°”ê¾¸ê±°ë‚˜, ì•„ë‹ˆë©´ ê·¸ëƒ¥ ì •ë‹µ ë‹¨ì–´ë§Œ ë³´ì—¬ì£¼ëŠ” ê²Œ ì•„ë‹ˆë¼ ë¬¸ì¥ ì „ì²´ë¥¼ ë³´ì—¬ì£¼ëŠ” ê²Œ ëª©í‘œ
        
        // *ì¤‘ìš”*: ì˜ˆë¬¸ ë°ì´í„° aì— "turn"ì´ë¼ê³  ë˜ì–´ìˆê³  qì— "[ ____ ]"ê°€ ìˆëŠ”ë°
        // ì–´ë–¤ ë¬¸ì œëŠ” ë¹ˆì¹¸ì´ ë‘ ê°œì¼ ìˆ˜ë„ ìˆìŒ.
        // ê°€ì¥ ê°„ë‹¨í•˜ê³  í™•ì‹¤í•œ ë°©ë²•: ë’·ë©´ì—ëŠ” "ë¬¸ì¥ ì „ì²´(ë¹ˆì¹¸ ì±„ì›Œì§„)"ë¥¼ ë³´ì—¬ì£¼ëŠ” ê²ƒ.
        // ì—¬ê¸°ì„œëŠ” ì½”ë“œë¡œ ìë™ ì¹˜í™˜ì´ ì–´ë ¤ìš°ë‹ˆ (ë¹ˆì¹¸ ê°œìˆ˜ ë“±), 
        // 1. ì•ë©´: eng (ë¹ˆì¹¸ í¬í•¨)
        // 2. ë’·ë©´: engì—ì„œ [ ___ ]ë¥¼ [ item.a(ë¹¨ê°•) ] ë¡œ êµì²´.
        // (ë‹¨, ë¹ˆì¹¸ì´ ì—¬ëŸ¬ê°œë©´ item.aë„ ì—¬ëŸ¬ ë‹¨ì–´ì—¬ì•¼ í•¨. í˜„ì¬ ë°ì´í„° êµ¬ì¡°ìƒ aëŠ” ì •ë‹µ í…ìŠ¤íŠ¸ ì „ì²´ì„)
        // ì˜ˆë¥¼ ë“¤ì–´ a="try on", q="... [ ___ ] [ ___ ] ..." ì´ë©´
        // ë‹¨ìˆœ ì¹˜í™˜ì€ ì–´ë ¤ì›€.
        
        // ê·¸ë˜ì„œ "ë’·ë©´"ì—ëŠ” ê·¸ëƒ¥ [ ì •ë‹µ ] ì´ë ‡ê²Œ ë³´ì—¬ì£¼ëŠ” ëŒ€ì‹ 
        // ì›ë˜ ë¬¸ì¥ì˜ ë¹ˆì¹¸ ë¶€ë¶„ì— ìƒ‰ê¹”ì„ ë„£ì–´ì„œ ë³´ì—¬ì£¼ëŠ” ë¡œì§ì´ í•„ìš”í•¨.
        // í•˜ì§€ë§Œ ë¹ˆì¹¸ ê°œìˆ˜ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ, 
        // ë’·ë©´ì—ëŠ” "ì™„ì„±ëœ ë¬¸ì¥"ì„ ë³´ì—¬ì£¼ëŠ” ê²Œ ì¢‹ì§€ë§Œ ë°ì´í„°ì— ì™„ì„±ëœ ë¬¸ì¥ì´ ì—†ìŒ.
        
        // ëŒ€ì•ˆ: ë’·ë©´ì—ëŠ” "ì •ë‹µ: ë¹¨ê°„ìƒ‰" + "í•œê¸€ ëœ»"ì„ ë³´ì—¬ì¤Œ. 
        // í˜¹ì€ ë¹ˆì¹¸ì´ í¬í•¨ëœ ë¬¸ì¥ì—ì„œ ë¹ˆì¹¸ì„ ì •ë‹µìœ¼ë¡œ êµì²´ ì‹œë„.
        
        // ì—¬ê¸°ì„œëŠ” ê°€ì¥ ê¹”ë”í•˜ê²Œ:
        // ì•ë©´: ë¬¸ì¥(ë¹ˆì¹¸) + í•œê¸€
        // ë’·ë©´: ë¬¸ì¥(ë¹ˆì¹¸ì— ë¹¨ê°„ìƒ‰ ì •ë‹µ ì±„ì›€) + í•œê¸€
        
        // ì •ë‹µ(a)ì„ ê°€ì§€ê³  ë¹ˆì¹¸(______)ì„ êµì²´í•˜ëŠ” ë¡œì§
        // ë¹ˆì¹¸ì´ ì—¬ëŸ¬ ê°œì¼ ê²½ìš° ([ ____ ] [ ____ ]) -> ì •ë‹µì´ "try on"ì´ë©´
        // ì²« ë²ˆì§¸ [ ____ ]ë¥¼ try, ë‘ ë²ˆì§¸ë¥¼ onìœ¼ë¡œ? ì´ê±´ ë³µì¡í•¨.
        
        // ê°€ì¥ í˜„ì‹¤ì ì¸ í•´ê²°ì±…:
        // ë’·ë©´ì—ëŠ” item.a (ì •ë‹µ)ë¥¼ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í¬ê²Œ ë³´ì—¬ì£¼ê³ , 
        // ê·¸ ì•„ë˜ì— í•œê¸€ ëœ»ì„ ë³´ì—¬ì£¼ëŠ” ê²Œ ëª…í™•í•¨.
        // (ë¬¸ì¥ ì†ì— ë„£ìœ¼ë ¤ë©´ ë¬¸ì¥ êµ¬ì¡°ë¥¼ ë¶„ì„í•´ì•¼ í•¨)
        
        // ìš”ì²­í•˜ì‹  "ë¬¸ì¥ ì†ì— ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ì™ ë“¤ì–´ê°„ ëª¨ìŠµ"ì„ êµ¬í˜„í•˜ë ¤ë©´:
        // ì •ë‹µ í…ìŠ¤íŠ¸ë¥¼ ë¹ˆì¹¸ ëŒ€ì‹  ë„£ì–´ì•¼ í•¨.
        // í˜„ì¬ ë°ì´í„° aëŠ” "turn"ì´ê³  qëŠ” "[ ____ ]"ì„.
        // ë‹¨ìˆœíˆ replace("[ ______ ]", item.a) í•˜ë©´ ë¨.
        // ë¹ˆì¹¸ì´ ì—¬ëŸ¬ ê°œì¸ ê²½ìš° (try on), aê°€ "try on"ì´ë‹ˆê¹Œ "[ try on ] [ ____ ]" ì´ë ‡ê²Œ ë  ìˆ˜ë„ ìˆìŒ.
        // -> ì´ ë¶€ë¶„ì€ ë³µì¡í•˜ë‹ˆ, "ë’·ë©´ì—” ì •ë‹µ ë‹¨ì–´ë¥¼ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í¬ê²Œ ë³´ì—¬ì¤Œ"ìœ¼ë¡œ íƒ€í˜‘í•˜ê±°ë‚˜
        // -> ì •ë‹µ ë‹¨ì–´ aë¥¼ ê°€ì§€ê³  ë¹ˆì¹¸ì„ ì±„ìš°ëŠ” ì •ê·œì‹ ì‚¬ìš©.
        
        let backEng = eng;
        // ë¹ˆì¹¸ íŒ¨í„´: [ ______ ] ë˜ëŠ” [______]
        const blankRegex = /\[\s*______\s*\]/g;
        
        // ì •ë‹µì´ ì—¬ëŸ¬ ë‹¨ì–´(ê³µë°± í¬í•¨)ì¸ ê²½ìš°, ë¹ˆì¹¸ ê°œìˆ˜ë§Œí¼ ìª¼ê°œì„œ ë„£ê¸°?
        // ì˜ˆ: a="try on", q="[ __ ] [ __ ]" -> split a by space -> try, on -> replace sequentially.
        const answerParts = item.a.split(' ');
        let partIndex = 0;
        
        // ë¹ˆì¹¸ì„ í•˜ë‚˜ì”© ì°¾ì•„ì„œ ì •ë‹µ ë‹¨ì–´ë¡œ êµì²´ (ë¹¨ê°„ìƒ‰ íƒœê·¸ ì…í˜€ì„œ)
        backEng = backEng.replace(blankRegex, (match) => {
            if (partIndex < answerParts.length) {
                const word = answerParts[partIndex++];
                return `[ <span style='color:red'>${word}</span> ]`;
            }
            return match; // ì •ë‹µ ë‹¨ì–´ê°€ ëª¨ìë¥´ë©´ ë¹ˆì¹¸ ìœ ì§€
        });
        
        // ë§Œì•½ ì •ë‹µ ë‹¨ì–´ ìˆ˜ê°€ ë¹ˆì¹¸ë³´ë‹¤ ì ê±°ë‚˜ ë§ìœ¼ë©´? 
        // ê·¸ëƒ¥ í†µì§¸ë¡œ aë¥¼ ë„£ëŠ” ê²Œ ë‚˜ì„ ìˆ˜ë„ ìˆìŒ. (ì˜ˆ: a="talking on the phone")
        // ìœ„ ë¡œì§ì€ ë‹¨ì–´ ê°œìˆ˜ì™€ ë¹ˆì¹¸ ê°œìˆ˜ê°€ ë§ì•„ì•¼ ì˜ˆì¨.
        // ì¼ë‹¨ ìœ„ ë¡œì§(ìª¼ê°œì„œ ë„£ê¸°)ì„ ì ìš©í•´ë³´ê³ , ì•ˆ ë§ìœ¼ë©´ í†µì§¸ë¡œ ë„£ê¸°.
        
        // ì˜ˆì™¸ ì²˜ë¦¬: ì •ë‹µì´ í•œ ë©ì–´ë¦¬ì¸ë° ë¹ˆì¹¸ì€ ì—¬ëŸ¬ê°œì¼ ë•Œ (ì—†ê¸°ë¥¼ ë°”ë¼ë©°)
        // í˜¹ì€ ì •ë‹µì´ ë¬¸ì¥í˜•ì¼ ë•Œ.
        
        const frontHtml = `<div class="card-text-main">${eng}</div><div class="card-text-sub">${kor}</div>`;
        const backHtml = `<div class="card-text-main">${backEng}</div><div class="card-text-sub">${kor}</div>`;
        
        renderCardHtml(frontHtml, backHtml, false);

    } else { // í€´ì¦ˆ
        let displayQ = item.q;
        if(currentMode === 4) {
             let match = item.q.match(/\(([^)]+)\)/); 
             if(match) { let eng = item.q.replace(match[0], "").trim(); displayQ = `${eng}<br><span style="color:#ff6b6b; font-size:18px;">(${match[1]})</span>`; }
        }
        document.getElementById('quiz-question').innerHTML = displayQ;
        document.getElementById('quiz-input').value = "";
        document.getElementById('quiz-msg').innerText = "";
        document.getElementById('btn-check').style.display = 'inline-block';
        document.getElementById('btn-next').style.display = 'none';
        document.getElementById('quiz-input').focus();
    }
  }

  function renderCard(frontText, backText, showFrontSpeaker) {
     renderCardHtml(`<div class="card-text-main">${frontText}</div>`, `<div class="card-text-main">${backText}</div>`, showFrontSpeaker);
  }

  function renderCardHtml(frontHtml, backHtml, showFrontSpeaker) {
    const card = document.getElementById('flashcard');
    card.classList.remove('is-flipped');
    document.getElementById('btn-speak-front').style.display = showFrontSpeaker ? 'inline-flex' : 'none';
    setTimeout(() => {
        document.getElementById('card-front-content').innerHTML = frontHtml;
        document.getElementById('card-back-content').innerHTML = backHtml;
    }, 200);
  }

  function playCurrentAudio(e) {
    if(e) e.stopPropagation();
    let textToPlay = studyList[currentIndex].a;
    playAudio(textToPlay);
  }

  function playAudio(text) { 
    if(!text) return;
    const url = `https://translate.google.com/translate_tts?ie=UTF-8&tl=en&client=tw-ob&q=${encodeURIComponent(text)}`;
    new Audio(url).play(); 
  }

  function mark(isCorrect) { if(!isCorrect) wrongList.push(studyList[currentIndex]); currentIndex++; showItem(); }
  function checkAnswer() {
    const user = document.getElementById('quiz-input').value.trim().toLowerCase();
    const ans = studyList[currentIndex].a.toLowerCase();
    const msg = document.getElementById('quiz-msg');
    if(user === ans) { msg.innerHTML = "<span style='color:green'>ì •ë‹µ! â­•</span>"; playAudio(ans); }
    else { msg.innerHTML = `<span style='color:red'>ë•¡! ì •ë‹µ: ${ans}</span>`; wrongList.push(studyList[currentIndex]); }
    document.getElementById('btn-check').style.display = 'none'; document.getElementById('btn-next').style.display = 'inline-block'; document.getElementById('btn-next').focus();
  }
  function nextItem() { currentIndex++; showItem(); }
  function finishStudy() { document.getElementById('card-area').style.display = 'none'; document.getElementById('quiz-area').style.display = 'none'; document.getElementById('result-box').style.display = 'block'; const msg = document.getElementById('result-msg'); const retryBtn = document.getElementById('btn-retry'); if(wrongList.length > 0) { msg.innerText = `${wrongList.length}ê°œë¥¼ í‹€ë ¸ì–´ìš”. ë‹¤ì‹œ ë„ì „!`; retryBtn.style.display = 'inline-block'; retryBtn.innerText = `ğŸ”¥ í‹€ë¦° ${wrongList.length}ê°œ ë‹¤ì‹œ í•˜ê¸°`; } else { msg.innerText = "ğŸ‰ ì™„ë²½í•´ìš”! 100ì !"; retryBtn.style.display = 'none'; } }
  function retryWrong() { studyList = [...wrongList]; resetCurrentMode(); }
  function flipCard() { 
    const card = document.getElementById('flashcard');
    card.classList.toggle('is-flipped');
    if(card.classList.contains('is-flipped')) playAudio(studyList[currentIndex].a);
  }
  function exportData() {
    if(library.length === 0) { alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
    const dataStr = JSON.stringify(library);
    navigator.clipboard.writeText(dataStr).then(() => { alert("ë³µì‚¬ ì™„ë£Œ! ì¹´í†¡ìœ¼ë¡œ ë³´ë‚´ì„¸ìš”."); }).catch(() => prompt("ì½”ë“œ ë³µì‚¬:", dataStr));
  }
  function toggleImport() { const el = document.getElementById('import-area'); el.style.display = (el.style.display==='none'?'block':'none'); }
  function importData() {
    try {
        const data = JSON.parse(document.getElementById('dataInput').value.trim());
        if(confirm("ê¸°ì¡´ ë°ì´í„°ê°€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.")) { library = data; renderLibrary(); alert("ì™„ë£Œ!"); }
    } catch(e) { alert("ì½”ë“œê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤."); }
  }
  function showScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
  function showListScreen() { showScreen('screen-list'); init(); }
  window.onload = init;
</script>
</body>
</html>
