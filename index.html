<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë½€ë‘¥ì´ ë‹¨ì–´ì¥</title>
<link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Jua', sans-serif; background-color: #fff0f5; text-align: center; margin: 0; padding: 20px; color: #333; }
  .screen { display: none; max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
  .active { display: block; }
  .btn { border: none; padding: 10px 20px; border-radius: 15px; cursor: pointer; font-family: 'Jua', sans-serif; font-size: 16px; margin: 5px; transition: 0.2s; }
  .btn:hover { transform: scale(1.05); }
  .btn-primary { background: #ff9a9e; color: white; width: 100%; font-size: 20px; padding: 15px; }
  .btn-danger { background: #ff6b6b; color: white; }
  .btn-secondary { background: #a8d8ea; color: white; }
  .btn-dark { background: #555; color: white; font-size: 14px; }
  .list-item { background: #fff5f8; border: 2px solid #ffc3c3; padding: 15px; margin-bottom: 10px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; text-align: left; }
  .list-info { cursor: pointer; flex-grow: 1; }
  .list-title { font-size: 20px; color: #ff6b6b; font-weight: bold; }
  .list-desc { font-size: 13px; color: #888; }
  input[type="text"], textarea { width: 90%; padding: 12px; border: 2px solid #ffc3c3; border-radius: 10px; font-size: 16px; margin-top: 5px; font-family: sans-serif; }
  textarea { height: 100px; }
  .menu-bar { margin-bottom: 20px; }
  .menu-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
  .mode-btn { flex: 1; padding: 12px; border-radius: 15px; border: 2px solid #ddd; cursor: pointer; font-family: 'Jua', sans-serif; font-size: 16px; background: #fff; color: #555; }
  .mode-btn.selected { background: #ff9a9e; color: white; font-weight: bold; border-color: #ff9a9e; box-shadow: 0 4px 10px rgba(255,154,158,0.4); }
  .status-bar { font-size: 18px; color: #666; margin-bottom: 10px; }
  .card-container { perspective: 1000px; width: 100%; height: 380px; margin: 10px auto; cursor: pointer; }
  .card { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; }
  .card.is-flipped { transform: rotateY(180deg); }
  .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 4px solid #ff9a9e; background: white; padding: 20px; box-sizing: border-box; }
  .card-text-main { font-size: 32px; color: #333; word-break: keep-all; line-height: 1.4; font-weight: bold; }
  .card-text-sub { font-size: 20px; color: #ff6b6b; background-color: #fff0f5; border-radius: 10px; padding: 10px; margin-top: 10px; font-weight: bold; display: block; width: 90%; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
  .card-back { transform: rotateY(180deg); background-color: #ff9a9e; color: white; }
  .card-back .card-text-main { color: white; font-size: 36px; }
  .quiz-q { font-size: 22px; margin: 20px 0; font-weight: bold; word-break: keep-all; line-height: 1.5; }
  .quiz-input { width: 70%; padding: 10px; font-size: 20px; border: 3px solid #ff6b6b; border-radius: 10px; text-align: center; }
  .quiz-msg { height: 30px; margin: 10px 0; font-size: 18px; font-weight: bold; }
  .result-box { display: none; background: #fff3e0; padding: 20px; border-radius: 15px; margin-top: 20px; border: 2px dashed #ff9800; }
  .speak-btn { background: #f9f9f9; border: 2px solid #ddd; border-radius: 50%; width: 55px; height: 55px; cursor: pointer; font-size: 28px; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; z-index: 10; }
  .speak-btn:hover { transform: scale(1.1); background: #eee; }
  .ox-btn { width: 70px; height: 70px; border-radius: 50%; font-size: 30px; border: none; cursor: pointer; margin: 0 10px; box-shadow: 0 4px 0 rgba(0,0,0,0.1); }
  .ox-btn:active { transform: translateY(4px); box-shadow: none; }
  .btn-o { background: #a8e6cf; color: #2e7d32; }
  .btn-x { background: #ff8b94; color: #c62828; }
</style>
</head>
<body>

  <div id="screen-list" class="screen active">
    <h1>ğŸ¶ ë½€ë‘¥ì´ ë‹¨ì–´ì¥</h1>
    <div id="saved-list-container"></div>
    <div style="margin-top:20px; color:#666; font-size:14px;">* ë°ì´í„° ìˆ˜ì • ì‹œ ìë™ ê°±ì‹  *</div>
  </div>

  <div id="screen-input" class="screen">
    <h2 id="input-title">âœ¨ ë‚´ìš© ì±„ìš°ê¸°</h2>
    <input type="text" id="listTitle" placeholder="ì œëª©">
    <label style="display:block; text-align:left; margin-top:10px; font-weight:bold; color:#ff6b6b;">1. ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸</label>
    <textarea id="inputWords"></textarea>
    <label style="display:block; text-align:left; margin-top:10px; font-weight:bold; color:#ff6b6b;">2. ì˜ˆë¬¸ ë¹ˆì¹¸ ë¬¸ì œ</label>
    <textarea id="inputSentences"></textarea>
    <div style="margin-top:20px;">
      <button class="btn btn-secondary" onclick="showListScreen()">ì·¨ì†Œ</button>
      <button class="btn btn-primary" style="width:auto;" onclick="saveAndStart()">ì €ì¥í•˜ê³  ì‹œì‘ ğŸš€</button>
    </div>
  </div>

  <div id="screen-study" class="screen">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <button class="btn btn-secondary" style="font-size:14px;" onclick="showListScreen()">ğŸ  ì„œì¬ë¡œ</button>
      <span id="study-title" style="font-weight:bold; color:#ff6b6b;">Title</span>
    </div>
    <div class="menu-bar">
        <div class="menu-row">
            <button class="mode-btn selected" id="m1" onclick="changeMode(1)">ë‹¨ì–´ ì¹´ë“œ</button>
            <button class="mode-btn" id="m2" onclick="changeMode(2)">ë‹¨ì–´ í€´ì¦ˆ</button>
        </div>
        <div class="menu-row">
            <button class="mode-btn" id="m3" onclick="changeMode(3)">ì˜ˆë¬¸ ì¹´ë“œ</button>
            <button class="mode-btn" id="m4" onclick="changeMode(4)">ì˜ˆë¬¸ í€´ì¦ˆ</button>
        </div>
    </div>
    <div id="study-container">
        <div class="status-bar" id="status-display">1 / 10</div>
        
        <div id="card-area" style="display:block;">
            <div class="card-container" onclick="flipCard()">
                <div class="card" id="flashcard">
                    <div class="card-face card-front">
                        <div id="card-front-content" style="width:100%;"></div> 
                        <!-- ì•ë©´ ìŠ¤í”¼ì»¤ ë²„íŠ¼ -->
                        <div id="btn-speak-front" class="speak-btn" onclick="playCurrentAudio(event)">ğŸ”Š</div>
                    </div>
                    <div class="card-face card-back">
                        <div id="card-back-content" style="width:100%;"></div> 
                        <!-- ë’·ë©´ ìŠ¤í”¼ì»¤ ë²„íŠ¼ -->
                        <div class="speak-btn" style="color:#333;" onclick="playCurrentAudio(event)">ğŸ”Š</div>
                    </div>
                </div>
            </div>
            <div style="margin-top:10px;" id="ox-buttons">
                <button class="ox-btn btn-x" onclick="mark(false)">âŒ</button>
                <button class="ox-btn btn-o" onclick="mark(true)">â­•</button>
            </div>
        </div>

        <div id="quiz-area" style="display:none;">
            <div id="quiz-question" class="quiz-q">ë¬¸ì œ</div>
            <input type="text" id="quiz-input" class="quiz-input" placeholder="ì •ë‹µ ì…ë ¥" autocomplete="off" onkeyup="if(window.event.keyCode==13){checkAnswer()}">
            <div id="quiz-msg" class="quiz-msg"></div>
            <button class="btn btn-primary" style="width:auto; margin-top:10px;" id="btn-check" onclick="checkAnswer()">í™•ì¸</button>
            <button class="btn btn-dark" style="display:none;" id="btn-next" onclick="nextItem()">ë‹¤ìŒ â–¶</button>
        </div>

        <div id="result-box" class="result-box">
            <h3 id="result-msg">ê²°ê³¼</h3>
            <button class="btn btn-danger" id="btn-retry" onclick="retryWrong()">ğŸ”¥ í‹€ë¦° ê²ƒë§Œ ë‹¤ì‹œ í•˜ê¸°</button>
            <button class="btn btn-secondary" onclick="resetCurrentMode()">ğŸ”„ ì „ì²´ ë‹¤ì‹œ í•˜ê¸°</button>
        </div>
        
        <div style="margin-top:30px; border-top:1px dashed #ccc; padding-top:10px;">
             <button class="btn btn-dark" onclick="shuffleCurrent()">ğŸ”€ ìˆœì„œ ì„ê¸°</button>
        </div>
    </div>
  </div>

<script>
  // ==========================================
  // ğŸ‘‡ 1. ë°ì´í„° ì €ì¥ì†Œ (ì†í¥ë¯¼ ì‚­ì œë¨)
  // ==========================================
  const defaultData = [
    {
      title: "Day 17 (0321~0340)",
      words: [
        {q:"ë°”ìœ, í˜¼ì¡í•œ", a:"busy"}, {q:"ì¼ì°, ë¹¨ë¦¬", a:"early"}, {q:"ìŒì‹, ì‹ëŸ‰", a:"food"}, {q:"ê±°ì˜", a:"almost"},
        {q:"ê°€ì ¸ì˜¤ë‹¤", a:"bring"}, {q:"ê·¸ë¦¬ë‹¤, ëŒë‹¤", a:"draw"}, {q:"ê°€ë¡œì§€ë¥´ë‹¤", a:"cross"}, {q:"~ìœ„ì—, ~ë„˜ëŠ”", a:"over"},
        {q:"ë…¸ë˜í•˜ë‹¤", a:"sing"}, {q:"ì˜ì‚¬", a:"doctor"}, {q:"íŠ¹ë³„í•œ", a:"special"}, {q:"ì•½í•œ", a:"weak"},
        {q:"ê³„ë‹¨", a:"stair"}, {q:"ì–´ëŠ ê²ƒ", a:"which"}, {q:"ê¸¸, ë„ë¡œ", a:"road"}, {q:"ë¶€ì—Œ", a:"kitchen"},
        {q:"ê°„ì‹", a:"snack"}, {q:"í•œ ìŒ, ì¼¤ë ˆ", a:"pair"}, {q:"ìš”ì¦˜", a:"these days"}, {q:"ì´í•´í•˜ë‹¤", a:"get it"}
      ],
      sentences: [
        {q:"busy (ë‚˜ëŠ” ì§€ê¸ˆ ë§¤ìš° ë°”ì˜ë‹¤) I am very [ ______ ] now.", a:"busy"},
        {q:"early (ê·¸ëŠ” ì˜¤ëŠ˜ ì¼ì° ì¼ì–´ë‚¬ë‹¤) He got up [ ______ ] today.", a:"early"},
        {q:"food (ìš°ë¦¬ëŠ” ìŒì‹ì´ ì¢€ í•„ìš”í•˜ë‹¤) We need some [ ______ ].", a:"food"},
        {q:"almost (ê±°ì˜ 12ì‹œë‹¤) It's [ ______ ] 12 o'clock.", a:"almost"},
        {q:"bring (ë‚´ì¼ ë„¤ ìˆ™ì œë¥¼ ê°€ì ¸ì™€ë¼) Please [ ______ ] your homework tomorrow.", a:"bring"},
        {q:"draw (ì›ì„ í•˜ë‚˜ ê·¸ë ¤ë¼) [ ______ ] a circle.", a:"draw"},
        {q:"cross (ê¸¸ì„ ê±´ë„ˆì§€ ë§ˆë¼) Don't [ ______ ] the street.", a:"cross"},
        {q:"over (ê·¸ ê°œëŠ” ë‹´ì¥ì„ ë„˜ì–´ ì í”„í–ˆë‹¤) The dog jumped [ ______ ] the fence.", a:"over"},
        {q:"sang (ê·¸ë“¤ì€ ë°©ê³¼ í›„ì— ë…¸ë˜í–ˆë‹¤) They [ ______ ] after school.", a:"sang"},
        {q:"doctor (ì˜ì‚¬ëŠ” ë¬¼ì„ ë§ˆì‹œë¼ê³  í–ˆë‹¤) The [ ______ ] told me to drink water.", a:"doctor"},
        {q:"special (íŠ¹ë³„ ë©”ë‰´ê°€ ìˆë‚˜ìš”?) Do you have a [ ______ ] menu?", a:"special"},
        {q:"weak (í• ë¨¸ë‹ˆëŠ” ë‹¤ë¦¬ê°€ ì•½í•˜ì‹œë‹¤) My grandmother has [ ______ ] legs.", a:"weak"},
        {q:"stairs (ê·¸ëŠ” ê³„ë‹¨ì„ ì˜¬ë¼ê°”ë‹¤) He went up the [ ______ ].", a:"stairs"},
        {q:"Which (ì–´ë–¤ ê²ƒì´ ë„¤ ì±…ì´ë‹ˆ?) [ ______ ] is your book?", a:"Which"},
        {q:"road (ë„ë¡œì— ì°¨ë“¤ì´ ë§ë‹¤) There are a lot of cars on the [ ______ ].", a:"road"},
        {q:"kitchen (ê·¸ë…€ëŠ” ë¶€ì—Œì—ì„œ ìš”ë¦¬ì¤‘ì´ë‹¤) She is cooking in the [ ______ ].", a:"kitchen"},
        {q:"snack (ë‚˜ëŠ” ê°„ì‹ìœ¼ë¡œ ì´ˆì½œë¦¿ì„ ì¢‹ì•„í•œë‹¤) I like chocolate for a [ ______ ].", a:"snack"},
        {q:"pair (ê·¸ë…€ëŠ” ìƒˆ ì•ˆê²½ í•˜ë‚˜ë¥¼ ìƒ€ë‹¤) She bought a new [ ______ ] of glasses.", a:"pair"},
        {q:"these days (ìš”ì¦˜ ë‚ ì”¨ê°€ ì¢‹ë‹¤) The weather is nice [ ______ ] [ ______ ].", a:"these days"},
        {q:"get it (ì €ëŠ” ì´í•´ë¥¼ ëª»í•˜ê² ì–´ìš”) I don't [ ______ ] [ ______ ].", a:"get it"}
      ]
    },
    {
      title: "Day 18 (0341~0360)",
      words: [
        {q:"ë³‘, í•œ ë³‘", a:"bottle"}, {q:"ì‹œê³„", a:"clock"}, {q:"ê¿ˆ, ê¿ˆê¾¸ë‹¤", a:"dream"}, {q:"ì™„ì „í•œ, ì™„ë£Œí•˜ë‹¤", a:"complete"},
        {q:"ê³„ì ˆ", a:"season"}, {q:"ì£½ë‹¤", a:"die"}, {q:"ê°€ê²Œ", a:"store"}, {q:"ë–¨ì–´ì ¸, ë©€ë¦¬", a:"off"},
        {q:"íŒ”ë‹¤", a:"sell"}, {q:"ì…", a:"mouth"}, {q:"ì¥ê°‘", a:"glove"}, {q:"ì ‘ì‹œ", a:"dish"},
        {q:"ì‹¬ì¥, ë§ˆìŒ", a:"heart"}, {q:"ê·¸ë¦¼, ì‚¬ì§„", a:"picture"}, {q:"ì, ë‚˜ë­‡ì", a:"leaf"}, {q:"ë³‘ì›", a:"hospital"},
        {q:"ë‹¤ë¦¬", a:"bridge"}, {q:"ìœ ìš©í•œ", a:"useful"}, {q:"ì§„ì°°ë°›ë‹¤", a:"see a doctor"}, {q:"ì§‘ë‹¤, íƒœìš°ë‹¤", a:"pick up"}
      ],
      sentences: [
        {q:"bottle (ì´ ë³‘ ì¢€ ì—´ì–´ì£¼ì‹œê² ì–´ìš”?) Would you open this [ ______ ]?", a:"bottle"},
        {q:"clock (ì´ ì‹œê³„ëŠ” 5ë¶„ ë¹ ë¥´ë‹¤) This [ ______ ] is five minutes fast.", a:"clock"},
        {q:"dream (ê·¸ëŠ” ì•…ëª½ì„ ê¾¸ì—ˆë‹¤) He had a bad [ ______ ].", a:"dream"},
        {q:"complete (ìš°ë¦¬ëŠ” ì¼ì„ ì™„ë£Œí•´ì•¼ í•œë‹¤) We should [ ______ ] the work.", a:"complete"},
        {q:"season (ì–´ë–¤ ê³„ì ˆì„ ì¢‹ì•„í•˜ë‹ˆ?) Which [ ______ ] do you like?", a:"season"},
        {q:"died (ê·¸ ê°œëŠ” ì‘ë…„ì— ì£½ì—ˆë‹¤) The dog [ ______ ] last year.", a:"died"},
        {q:"store (ê°€ê²Œì—ì„œ ë‹¬ê±€ì„ ì‚¬ë¼) Buy eggs at the [ ______ ].", a:"store"},
        {q:"off (ê·¸ëŠ” ë§ì—ì„œ ë–¨ì–´ì¡Œë‹¤) He fell [ ______ ] the horse.", a:"off"},
        {q:"sells (ì´ ê°€ê²ŒëŠ” ëª¨ìë¥¼ íŒë‹¤) This store [ ______ ] caps.", a:"sells"},
        {q:"mouth (ì…ì„ ë²Œë ¤ë¼) Open your [ ______ ].", a:"mouth"},
        {q:"gloves (ë‚˜ëŠ” ì¥ê°‘ì„ ê¼ˆë‹¤) I put on [ ______ ].", a:"gloves"},
        {q:"dish (ê·¸ë…€ëŠ” ì ‘ì‹œë¥¼ ìƒ€ë‹¤) She bought a [ ______ ].", a:"dish"},
        {q:"heart (ê·¸ëŠ” ì‹¬ì¥ì´ ì•½í•˜ë‹¤) He has a weak [ ______ ].", a:"heart"},
        {q:"picture (ë‚˜ëŠ” ê·¸ë¦¼ì„ ê·¸ë¦¬ê³  ìˆë‹¤) I'm drawing a [ ______ ].", a:"picture"},
        {q:"Leaves (ë‚˜ë­‡ìë“¤ì´ ë¹¨ê°›ë‹¤) [ ______ ] are red.", a:"Leaves"},
        {q:"hospital (ë³‘ì›ì— ì•„í”ˆ ì•„ì´ë“¤ì´ ë§ë‹¤) Many sick children at the [ ______ ].", a:"hospital"},
        {q:"bridge (ë‚˜ëŠ” ë‹¤ë¦¬ë¥¼ ê±´ë„œë‹¤) I crossed the [ ______ ].", a:"bridge"},
        {q:"useful (ì´ ìˆ˜ì—…ì€ ìœ ìš©í•  ê²ƒì´ë‹¤) This class will be [ ______ ].", a:"useful"},
        {q:"see a doctor (ë„ˆëŠ” ë³‘ì›ì— ê°€ì•¼í•´) You should [ ______ ] [ ______ ] [ ______ ].", a:"see a doctor"},
        {q:"picked up (ê·¸ë…€ëŠ” ì±…ì„ ì§‘ì—ˆë‹¤) She [ ______ ] [ ______ ] a book.", a:"picked up"}
      ]
    }
  ];

  let library = defaultData; 
  let currentSet = {};
  let studyList = [];
  let wrongList = [];
  let currentIndex = 0;
  let currentMode = 1;
  let editingIndex = -1;

  function init() { renderLibrary(); }
  function renderLibrary() {
    const con = document.getElementById('saved-list-container');
    con.innerHTML = "";
    library.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'list-item';
        div.innerHTML = `
            <div class="list-info" onclick="openStudy(${idx})">
                <div class="list-title">${item.title}</div>
                <div class="list-desc">ë‹¨ì–´ ${item.words.length}ê°œ / ì˜ˆë¬¸ ${item.sentences.length}ê°œ</div>
            </div>
            <div class="btn-group">
                <button class="btn btn-edit" style="padding:5px 10px;" onclick="editItem(${idx})">ìˆ˜ì •</button>
                <button class="btn btn-danger" style="font-size:12px; padding:5px 10px;" onclick="delItem(${idx})">ì‚­ì œ</button>
            </div>
        `;
        con.appendChild(div);
    });
  }
  function delItem(idx) { if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { library.splice(idx, 1); renderLibrary(); } }

  // === ì…ë ¥/ìˆ˜ì • ë¡œì§ ===
  function showInputScreen() { showScreen('screen-input'); editingIndex = -1; document.getElementById('input-title').innerText = "âœ¨ ìƒˆ ë‹¨ì–´ì¥ ë§Œë“¤ê¸°"; document.getElementById('listTitle').value = ""; document.getElementById('inputWords').value = ""; document.getElementById('inputSentences').value = ""; }
  function editItem(idx) {
    showScreen('screen-input'); editingIndex = idx; document.getElementById('input-title').innerText = "âœï¸ ë‹¨ì–´ì¥ ìˆ˜ì •í•˜ê¸°";
    const item = library[idx];
    document.getElementById('listTitle').value = item.title;
    document.getElementById('inputWords').value = item.words.map(w => `${w.a}\t${w.q}`).join('\n');
    document.getElementById('inputSentences').value = item.sentences.map(s => `${s.a}\t${s.q}`).join('\n');
  }
  function saveAndStart() {
    const title = document.getElementById('listTitle').value.trim();
    const wText = document.getElementById('inputWords').value.trim();
    const sText = document.getElementById('inputSentences').value.trim();
    if(!title) return alert("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!");
    const words = parseText(wText);
    const sentences = parseText(sText);
    const newItem = { title, words, sentences };
    if(editingIndex === -1) { library.push(newItem); openStudy(library.length - 1); } 
    else { library[editingIndex] = newItem; openStudy(editingIndex); }
  }
  function parseText(text) {
    if(!text) return [];
    return text.split('\n').map(line => {
        line = line.trim(); if(!line) return null;
        let parts = line.split(/[\t]+| {2,}/);
        if(parts.length < 2 && line.includes(' ')) { let idx = line.indexOf(' '); parts = [line.substring(0, idx), line.substring(idx+1)]; }
        if(parts.length >= 2) return { q: parts[1].trim(), a: parts[0].trim() };
        return null;
    }).filter(x => x);
  }

  function openStudy(idx) { currentSet = library[idx]; document.getElementById('study-title').innerText = currentSet.title; showScreen('screen-study'); changeMode(1); }
  function changeMode(mode) {
    currentMode = mode;
    [1,2,3,4].forEach(n => document.getElementById(`m${n}`).className = 'mode-btn' + (n===mode ? ' selected' : ''));
    if(mode === 1 || mode === 2) studyList = [...currentSet.words];
    else {
        studyList = [...currentSet.sentences];
        if(studyList.length === 0) { alert("ì˜ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤."); changeMode(1); return; }
    }
    resetCurrentMode();
  }
  function resetCurrentMode() { currentIndex = 0; wrongList = []; document.getElementById('result-box').style.display = 'none'; const isCard = (currentMode === 1 || currentMode === 3); document.getElementById('card-area').style.display = isCard ? 'block' : 'none'; document.getElementById('quiz-area').style.display = isCard ? 'none' : 'block'; showItem(); }
  function shuffleCurrent() { studyList.sort(() => Math.random() - 0.5); resetCurrentMode(); }

  // === í™”ë©´ í‘œì‹œ (ë°œìŒ ê¸°ëŠ¥ ìˆ˜ì •ë¨) ===
  function showItem() {
    if(currentIndex >= studyList.length) { finishStudy(); return; }
    const item = studyList[currentIndex];
    document.getElementById('status-display').innerText = `${currentIndex + 1} / ${studyList.length}`;

    if(currentMode === 1) { // ë‹¨ì–´ ì¹´ë“œ
        renderCard(item.a, item.q, true); 
    } else if(currentMode === 3) { // ì˜ˆë¬¸ ì¹´ë“œ
        let match = item.q.match(/\(([^)]+)\)/); 
        let kor = ""; let eng = item.q;
        if(match) { kor = match[1]; eng = item.q.replace(match[0], "").trim(); }
        const frontHtml = `<div class="card-text-main">${eng}</div><div class="card-text-sub">${kor}</div>`;
        const backHtml = `<div class="card-text-main">${item.a}</div>`;
        renderCardHtml(frontHtml, backHtml, false);
    } else { // í€´ì¦ˆ
        let displayQ = item.q;
        if(currentMode === 4) {
             let match = item.q.match(/\(([^)]+)\)/); 
             if(match) { let eng = item.q.replace(match[0], "").trim(); displayQ = `${eng}<br><span style="color:#ff6b6b; font-size:18px;">(${match[1]})</span>`; }
        }
        document.getElementById('quiz-question').innerHTML = displayQ;
        document.getElementById('quiz-input').value = "";
        document.getElementById('quiz-msg').innerText = "";
        document.getElementById('btn-check').style.display = 'inline-block';
        document.getElementById('btn-next').style.display = 'none';
        document.getElementById('quiz-input').focus();
    }
  }

  function renderCard(frontText, backText, showFrontSpeaker) {
     renderCardHtml(`<div class="card-text-main">${frontText}</div>`, `<div class="card-text-main">${backText}</div>`, showFrontSpeaker);
  }

  function renderCardHtml(frontHtml, backHtml, showFrontSpeaker) {
    const card = document.getElementById('flashcard');
    card.classList.remove('is-flipped');
    document.getElementById('btn-speak-front').style.display = showFrontSpeaker ? 'inline-flex' : 'none';
    setTimeout(() => {
        document.getElementById('card-front-content').innerHTML = frontHtml;
        document.getElementById('card-back-content').innerHTML = backHtml;
    }, 200);
  }

  // === ë°œìŒ ì¬ìƒ (ìˆ˜ì •ë¨) ===
  function playCurrentAudio(e) {
    e.stopPropagation(); // ì¹´ë“œ ë’¤ì§‘íˆëŠ” ê²ƒ ë°©ì§€
    // í˜„ì¬ ë³´ê³  ìˆëŠ” ì¹´ë“œì˜ 'ì •ë‹µ(ì˜ì–´)'ë¥¼ ì½ì–´ì¤Œ
    const textToPlay = studyList[currentIndex].a;
    playAudio(textToPlay);
  }

  function playAudio(text) { 
    if(!text) return;
    const url = `https://translate.google.com/translate_tts?ie=UTF-8&tl=en&client=tw-ob&q=${encodeURIComponent(text)}`;
    new Audio(url).play(); 
  }

  // O/X ë° í€´ì¦ˆ
  function mark(isCorrect) { if(!isCorrect) wrongList.push(studyList[currentIndex]); currentIndex++; showItem(); }
  function checkAnswer() {
    const user = document.getElementById('quiz-input').value.trim().toLowerCase();
    const ans = studyList[currentIndex].a.toLowerCase();
    const msg = document.getElementById('quiz-msg');
    if(user === ans) { msg.innerHTML = "<span style='color:green'>ì •ë‹µ! â­•</span>"; playAudio(ans); }
    else { msg.innerHTML = `<span style='color:red'>ë•¡! ì •ë‹µ: ${ans}</span>`; wrongList.push(studyList[currentIndex]); }
    document.getElementById('btn-check').style.display = 'none'; document.getElementById('btn-next').style.display = 'inline-block'; document.getElementById('btn-next').focus();
  }
  function nextItem() { currentIndex++; showItem(); }
  function finishStudy() { document.getElementById('card-area').style.display = 'none'; document.getElementById('quiz-area').style.display = 'none'; document.getElementById('result-box').style.display = 'block'; const msg = document.getElementById('result-msg'); const retryBtn = document.getElementById('btn-retry'); if(wrongList.length > 0) { msg.innerText = `${wrongList.length}ê°œë¥¼ í‹€ë ¸ì–´ìš”. ë‹¤ì‹œ ë„ì „!`; retryBtn.style.display = 'inline-block'; retryBtn.innerText = `ğŸ”¥ í‹€ë¦° ${wrongList.length}ê°œ ë‹¤ì‹œ í•˜ê¸°`; } else { msg.innerText = "ğŸ‰ ì™„ë²½í•´ìš”! 100ì !"; retryBtn.style.display = 'none'; } }
  function retryWrong() { studyList = [...wrongList]; resetCurrentMode(); }
  function flipCard() { const card = document.getElementById('flashcard'); card.classList.toggle('is-flipped'); }
  function showScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
  function showListScreen() { showScreen('screen-list'); init(); }
  window.onload = init;
</script>
</body>
</html>
